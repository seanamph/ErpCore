# ErpCore 專案開發進度

## 目前進度重點（最新更新：2025-01-27）

### 📝 本次更新（2025-01-27）
- ✅ **SYSW337 功能完整實現**：已完成已日結退貨單驗退調整作業功能（後端+前端）
  - 實現內容：
    - ✅ Controller 層: `PurchaseReceiptController` 已完整實現所有 SYSW337 相關 API 端點（路徑：`/api/v1/purchase-receipts/closed-return-adjustments-v2`）
    - ✅ Service 層: `PurchaseReceiptService` 已完整實現所有 SYSW337 相關方法（查詢、新增、修改、刪除、審核）
    - ✅ 共用 Repository 層: 與 SYSW530 共用 `PurchaseReceiptRepository` 和資料表
    - ✅ 共用 DTO 層: 與 SYSW530 共用 `ClosedReturnAdjustmentQueryDto`, `ClosedReturnOrderQueryDto`, `ApproveSettledAdjustmentDto` 等
    - ✅ API 整合: 在 `purchase.js` 中新增 `closedReturnAdjustmentV2Api` API 方法
    - ✅ **前端 Vue 頁面**: `ClosedReturnAdjustmentV2.vue` 已完整實現
    - ✅ 路由配置: 在 `router/index.js` 中新增 SYSW337 路由配置
  - 功能狀態：SYSW337 前後端已完整實現 ✨
  - 開發依據：`開發計劃/04-採購管理/SYSW337-已日結退貨單驗退調整作業.md`
  - Git 提交：已提交並推送到遠端倉庫（commit: 2af0ed9）
  - 注意：專案存在既有的編譯錯誤（命名空間引用、編碼問題），與新功能無關
- ✅ **SYSW333 功能完整實現**：已完成已日結採購單驗收調整作業功能（後端+前端）
  - 實現內容：
    - ✅ Entity 層: `PurchaseReceipt` 已包含已日結調整相關欄位（IsSettledAdjustment, OriginalReceiptId, AdjustmentReason）
    - ✅ Repository 層: `PurchaseReceiptRepository` 已實現 `QuerySettledAdjustmentsAsync`, `GetSettledAdjustmentsCountAsync`, `GetSettledOrdersAsync` 等方法
    - ✅ Service 層: `PurchaseReceiptService` 已完整實現所有 SYSW333 相關方法（查詢、新增、修改、刪除、審核）
    - ✅ Controller 層: `PurchaseReceiptController` 已完整實現所有 SYSW333 相關 API 端點（路徑：`/api/v1/purchase-receipts/settled-adjustments`）
    - ✅ DTO 層: `SettledPurchaseReceiptAdjustmentQueryDto`, `SettledOrderQueryDto`, `ApproveSettledAdjustmentDto` 已完整實現
    - ✅ API 整合: 在 `purchase.js` 中新增 `settledAdjustmentApi` API 方法
    - ✅ **前端 Vue 頁面**: `SettledPurchaseReceiptAdjustment.vue` 已完整實現
  - 功能狀態：SYSW333 前後端已完整實現 ✨
  - 開發依據：`開發計劃/04-採購管理/SYSW333-已日結採購單驗收調整作業.md`
  - 注意：專案存在既有的編譯錯誤（命名空間引用、編碼問題），與新功能無關
- ✅ **SYSW336 功能完整實現**：已完成採購單驗收作業功能（後端+前端）
  - 實現內容：
    - ✅ Controller 層: `PurchaseReceiptsV2Controller` 已完整實現所有 SYSW336 相關 API 端點（路徑：`/api/v1/purchase-receipts-v2`）
    - ✅ 共用 Service 層: 與 SYSW324 共用 `PurchaseReceiptService`
    - ✅ 共用 Repository 層: 與 SYSW324 共用 `PurchaseReceiptRepository` 和資料表
    - ✅ API 整合: 在 `purchase.js` 中新增 `purchaseReceiptV2Api` API 方法
    - ✅ **前端 Vue 頁面**: `PurchaseReceiptV2.vue` 已完整實現
  - 功能狀態：SYSW336 前後端已完整實現 ✨
  - 開發依據：`開發計劃/04-採購管理/SYSW336-採購單驗收作業.md`
  - Git 提交：已提交並推送到遠端倉庫（commit: 245c3ff）
- ✅ **SYSW316 功能完整實現**：已完成訂退貨申請作業功能（後端+前端）
  - 實現內容：
    - ✅ Controller 層: `PurchaseOrdersV2Controller` 已完整實現所有 SYSW316 相關 API 端點（路徑：`/api/v1/purchase-orders-v2`）
    - ✅ 共用 Service 層: 與 SYSW315 共用 `PurchaseOrderService`，通過 `SourceProgram = "SYSW316"` 區分
    - ✅ 共用 Repository 層: 與 SYSW315 共用 `PurchaseOrderRepository` 和資料表
    - ✅ API 整合: 在 `purchase.js` 中新增 `purchaseOrderV2Api` API 方法
    - ✅ **前端 Vue 頁面**: `PurchaseOrderV2.vue` 已完整實現
  - 功能狀態：SYSW316 前後端已完整實現 ✨
  - 開發依據：`開發計劃/04-採購管理/SYSW316-訂退貨申請作業.md`
  - Git 提交：已提交並推送到遠端倉庫（commit: 8203cfc）
- ✅ **SYSW324 功能完善**：已完成採購單驗收作業功能完善（後端）
  - 實現內容：
    - ✅ 完善 `PurchaseReceiptService.CreateReceiptFromOrderAsync`：從採購單獲取完整資料（主檔和明細）
    - ✅ 完善 `PurchaseReceiptService.CreatePurchaseReceiptAsync`：從採購單獲取 ShopId 和 SupplierId，並驗證驗收數量不超過可驗收數量
    - ✅ 在 `PurchaseOrderRepository` 添加 `UpdateReceiptQtyAsync` 方法：更新採購單明細已收數量
    - ✅ 完善 `PurchaseReceiptService.ConfirmReceiptAsync`：實現更新採購單已收數量邏輯（確認驗收時）
    - ✅ 完善 `PurchaseReceiptService.CancelPurchaseReceiptAsync`：實現回退採購單已收數量邏輯（取消驗收時）
    - ✅ 在 `PurchaseReceiptService` 中注入 `IPurchaseOrderRepository` 依賴
  - 功能狀態：SYSW324 後端邏輯已完善 ✨
  - 開發依據：`開發計劃/04-採購管理/SYSW324-採購單驗收作業.md`
  - Git 提交：已提交並推送到遠端倉庫（commit: 2595117）
- ✅ **SYSW315 功能完整實現**：已完成訂退貨申請作業功能（後端+前端）
  - 實現內容：
    - ✅ Entity 層: `PurchaseOrder` 和 `PurchaseOrderDetail` 實體已完整實現
    - ✅ Repository 層: `PurchaseOrderRepository` 和對應的介面已完整實現
    - ✅ Service 層: `PurchaseOrderService` 已完整實現
    - ✅ Controller 層: `PurchaseOrderController` 已完整實現所有 SYSW315 相關 API 端點
    - ✅ DTO 層: 所有 SYSW315 相關 DTO 已完整實現
    - ✅ API 整合: 在 `purchase.js` 中新增所有 SYSW315 相關的 API 方法
    - ✅ SQL 腳本: `CreatePurchaseOrderTables.sql` 已完整實現
    - ✅ **前端 Vue 頁面**: `PurchaseOrder.vue` 已完整實現
  - 功能狀態：SYSW315 前後端已完整實現 ✨
  - 開發依據：`開發計劃/04-採購管理/SYSW315-訂退貨申請作業.md`
  - Git 提交：已提交並推送到遠端倉庫（commit: 97a5766）
- ✅ **SYS0116 功能完整實現**：已完成排程修改使用者基本資料功能（後端+前端）
  - 功能狀態：SYS0116 前後端已完整實現 ✨
  - 開發依據：`開發計劃/01-系統管理/01-使用者管理/SYS0116-排程修改使用者基本資料.md`
  - Git 提交：已提交並推送到遠端倉庫（commit: 2124085）

### ⚠️ 已知問題
- **dotnet build**：專案存在一些既有的編譯錯誤（與新功能無關，主要是命名空間引用問題）
- **npm build**：專案存在一些既有檔案的編譯錯誤（與新功能無關，主要是編碼問題）

### 🎯 下一步建議
1. **選擇新功能開發**：從 `開發計劃/` 目錄選擇一個新功能進行開發
   - 建議：繼續開發其他採購管理相關功能或其他系統管理功能
2. **功能測試**：對 SYSW530 功能進行完整測試，確保功能正常運作
   - 測試已日結退貨單查詢功能
   - 測試新增已日結退貨單驗退調整單功能
   - 測試調整單審核流程
   - 測試調整數量、價格計算邏輯
3. **修復既有編譯錯誤**（可選）：解決專案中既有的編譯錯誤（命名空間引用問題、編碼問題）

---
## 📊 最新進度摘要（2025-01-27）

### ✅ 已完成功能清單
- **系統管理功能**：
  - ✅ SYS0110（使用者基本資料維護）、SYS0120（使用者資料瀏覽）、SYS0130（使用者帳戶原則管理）、SYS0140（使用者資料查詢）
  - ✅ SYS0111（使用者基本資料維護(業種儲位)）✨已完整實現
  - ✅ SYS0113（使用者基本資料維護(分店廠商部門)）✨已完整實現
  - ✅ SYS0114（使用者基本資料維護(ActiveDirectory)）✨已完整實現
  - ✅ **SYS0116（排程修改使用者基本資料）** ✨已完整實現
  - ✅ SYS0117（使用者權限代理）✨已完整實現
  - ✅ SYS0210（角色基本資料維護）、SYS0220（使用者之角色設定維護）、SYS0230（角色之使用者設定維護）、SYS0240（角色複製）
  - ✅ SYS0310（角色系統權限設定）、SYS0320（使用者系統權限設定）、SYS0330（角色欄位權限設定）、SYS0340（使用者欄位權限設定）、SYS0360（系統對應權限設定）
  - ✅ SYS0410（主系統項目資料維護）、SYS0420（子系統項目資料維護）、SYS0430（系統作業資料維護）、SYS0440（系統功能按鈕資料維護）
  - ✅ SYS0640（系統權限異動記錄查詢）、SYS0650（可管控欄位異動記錄查詢）、SYS0660（其他異動記錄查詢）、SYS0710（系統權限列表）、SYS0720（作業權限之使用者列表）、SYS0731（角色系統權限列表）、SYS0740（作業權限之角色列表）、SYS0750（角色之使用者列表）、SYS0760（使用者異常登入報表）、SYS0790（按鈕操作記錄查詢）、SYS0810（系統作業與功能列表查詢）、SYS0910（使用者查詢功能）✨已完整實現
- **異動記錄查詢功能**：
  - ✅ SYS0610（使用者基本資料異動查詢）、SYS0620（角色基本資料異動查詢）、SYS0630（使用者角色對應設定異動查詢）、SYS0640（系統權限異動記錄查詢）、SYS0650（可管控欄位異動記錄查詢）、SYS0660（其他異動記錄查詢）
- **基本資料管理功能**：SYSBC20（銀行基本資料維護）、SYSWB40（部別資料維護）、SYSWB60（庫別資料維護）、SYSWB70（組別資料維護）、SYSBC30（地區設定）、SYSB450（區域基本資料維護）、SYSBC40（參數資料設定維護）、SYSB110（商品分類資料維護）、SYSB206（廠/客基本資料維護）
- **進銷存管理功能**：SYSW110（供應商商品資料維護）、SYSW137（商品進銷碼維護）、SYSW150（商品永久變價）、SYSW170（POP卡商品卡列印）
- **採購管理功能**：
  - ✅ **SYSW315（訂退貨申請作業）** ✨已完整實現
  - ✅ **SYSW316（訂退貨申請作業）** ✨已完整實現
  - ✅ **SYSW322（現場打單作業）** ✨已完整實現
  - ✅ **SYSW324（採購單驗收作業）** ✨後端邏輯已完善
  - ✅ **SYSW333（已日結採購單驗收調整作業）** ✨已完整實現
  - ✅ **SYSW336（採購單驗收作業）** ✨已完整實現
  - ✅ **SYSW337（已日結退貨單驗退調整作業）** ✨已完整實現
  - ✅ **SYSW530（已日結退貨單驗退調整作業）** ✨已完整實現
- **下拉列表功能**：DATE_LIST、ADDR_ZONE_LIST、ADDR_CITY_LIST、SYSID_LIST、MULTI_USERS_LIST、MULTI_SHOP_LIST、MULTI_AREA_LIST、MENU_LIST、USER_LIST

### ⚠️ 已知問題
- **dotnet build**：專案存在一些既有的編譯錯誤（與新功能無關）
- **npm build**：專案存在一些既有檔案的編譯錯誤（與新功能無關）

### 🎯 下一步建議
1. **選擇新功能開發**：從開發計劃目錄選擇一個新功能（建議：繼續開發其他採購管理相關功能或其他系統管理功能）
2. **功能測試**：對 SYSW530 功能進行完整測試，確保功能正常運作
   - 測試已日結退貨單查詢功能
   - 測試新增已日結退貨單驗退調整單功能
   - 測試調整單審核流程
3. **修復既有編譯錯誤**（可選）：解決專案中既有的編譯錯誤
