# STD3000 - 標準模組系列 開發計劃

## 一、功能概述

### 1.1 功能說明
- **功能代碼**: STD3000 系列
- **功能名稱**: 標準模組系列
- **功能描述**: 提供標準3000系列功能，包含SYS3620系列功能模組
- **參考舊程式**: 
  - `WEB/IMS_CORE/ASP/STD3000/SYS3620_FB.ASP` (瀏覽)
  - `WEB/IMS_CORE/ASP/STD3000/SYS3620_FI2.ASP` (新增)
  - `WEB/IMS_CORE/ASP/STD3000/SYS3620_FQ.asp` (查詢)
  - `WEB/IMS_CORE/ASP/STD3000/SYS3620_FQ2.ASP` (查詢版本二)
  - `WEB/IMS_CORE/ASP/STD3000/SYS3620_FR.asp` (FR功能)

### 1.2 業務需求
- 提供SYS3620系列功能的資料維護
- 支援資料的新增、修改、刪除、查詢功能
- 支援資料瀏覽功能
- 支援資料報表功能

### 1.3 子模組清單
- **SYS3620**: 標準資料維護（瀏覽、新增、查詢、FR功能）

---

## 二、資料庫設計 (Schema)

### 2.1 主要資料表: `Std3000Data`

```sql
CREATE TABLE [dbo].[Std3000Data] (
    [TKey] BIGINT NOT NULL PRIMARY KEY IDENTITY(1,1),
    [DataId] NVARCHAR(50) NOT NULL, -- 資料代碼
    [DataName] NVARCHAR(100) NOT NULL, -- 資料名稱
    [DataValue] NVARCHAR(200) NULL, -- 資料值
    [DataType] NVARCHAR(20) NULL, -- 資料類型
    [Status] NVARCHAR(10) NOT NULL DEFAULT 'A', -- 狀態 (A:啟用, I:停用)
    [SortOrder] INT NULL DEFAULT 0, -- 排序順序
    [Memo] NVARCHAR(500) NULL, -- 備註
    [CreatedBy] NVARCHAR(50) NULL,
    [CreatedAt] DATETIME2 NOT NULL DEFAULT GETDATE(),
    [UpdatedBy] NVARCHAR(50) NULL,
    [UpdatedAt] DATETIME2 NOT NULL DEFAULT GETDATE(),
    CONSTRAINT [UQ_Std3000Data_DataId] UNIQUE ([DataId])
);

-- 索引
CREATE NONCLUSTERED INDEX [IX_Std3000Data_DataType] ON [dbo].[Std3000Data] ([DataType]);
CREATE NONCLUSTERED INDEX [IX_Std3000Data_Status] ON [dbo].[Std3000Data] ([Status]);
CREATE NONCLUSTERED INDEX [IX_Std3000Data_SortOrder] ON [dbo].[Std3000Data] ([SortOrder]);
```

### 2.2 資料字典

| 欄位名稱 | 資料類型 | 長度 | 允許NULL | 預設值 | 說明 | 備註 |
|---------|---------|------|---------|--------|------|------|
| TKey | BIGINT | - | NO | IDENTITY | 主鍵 | 自動遞增 |
| DataId | NVARCHAR | 50 | NO | - | 資料代碼 | 唯一 |
| DataName | NVARCHAR | 100 | NO | - | 資料名稱 | - |
| DataValue | NVARCHAR | 200 | YES | - | 資料值 | - |
| DataType | NVARCHAR | 20 | YES | - | 資料類型 | - |
| Status | NVARCHAR | 10 | NO | 'A' | 狀態 | A:啟用, I:停用 |
| SortOrder | INT | - | YES | 0 | 排序順序 | - |
| Memo | NVARCHAR | 500 | YES | - | 備註 | - |

---

## 三、後端 API 設計

### 3.1 查詢資料列表

```http
GET /api/v1/std3000/data?dataType={dataType}&status={status}&keyword={keyword}&page={page}&pageSize={pageSize}
```

**請求參數**:
- `dataType`: 資料類型（選填）
- `status`: 狀態（選填，A:啟用, I:停用）
- `keyword`: 關鍵字搜尋（選填，搜尋資料代碼或名稱）
- `page`: 頁碼（預設1）
- `pageSize`: 每頁筆數（預設20）

**回應格式**:
```json
{
  "success": true,
  "code": 200,
  "message": "查詢成功",
  "data": {
    "items": [
      {
        "tKey": 1,
        "dataId": "DATA001",
        "dataName": "資料名稱",
        "dataValue": "資料值",
        "dataType": "TYPE001",
        "status": "A",
        "sortOrder": 1,
        "memo": "備註",
        "createdBy": "USER001",
        "createdAt": "2024-01-01T00:00:00Z",
        "updatedBy": "USER001",
        "updatedAt": "2024-01-01T00:00:00Z"
      }
    ],
    "total": 100,
    "page": 1,
    "pageSize": 20,
    "totalPages": 5
  }
}
```

### 3.2 新增資料

```http
POST /api/v1/std3000/data
```

**請求體**:
```json
{
  "dataId": "DATA001",
  "dataName": "資料名稱",
  "dataValue": "資料值",
  "dataType": "TYPE001",
  "status": "A",
  "sortOrder": 1,
  "memo": "備註"
}
```

**回應格式**:
```json
{
  "success": true,
  "code": 200,
  "message": "新增成功",
  "data": {
    "tKey": 1,
    "dataId": "DATA001",
    "dataName": "資料名稱",
    "dataValue": "資料值",
    "dataType": "TYPE001",
    "status": "A",
    "sortOrder": 1,
    "memo": "備註",
    "createdBy": "USER001",
    "createdAt": "2024-01-01T00:00:00Z",
    "updatedBy": "USER001",
    "updatedAt": "2024-01-01T00:00:00Z"
  }
}
```

**錯誤回應**:
```json
{
  "success": false,
  "code": 400,
  "message": "資料代碼已存在",
  "data": null
}
```

### 3.3 修改資料

```http
PUT /api/v1/std3000/data/{tKey}
```

**請求體**:
```json
{
  "dataName": "修改後的資料名稱",
  "dataValue": "修改後的資料值",
  "dataType": "TYPE002",
  "status": "I",
  "sortOrder": 2,
  "memo": "修改備註"
}
```

**回應格式**:
```json
{
  "success": true,
  "code": 200,
  "message": "修改成功",
  "data": {
    "tKey": 1,
    "dataId": "DATA001",
    "dataName": "修改後的資料名稱",
    "dataValue": "修改後的資料值",
    "dataType": "TYPE002",
    "status": "I",
    "sortOrder": 2,
    "memo": "修改備註",
    "updatedBy": "USER001",
    "updatedAt": "2024-01-01T00:00:00Z"
  }
}
```

### 3.4 刪除資料

```http
DELETE /api/v1/std3000/data/{tKey}
```

**回應格式**:
```json
{
  "success": true,
  "code": 200,
  "message": "刪除成功",
  "data": null
}
```

**錯誤回應**:
```json
{
  "success": false,
  "code": 404,
  "message": "資料不存在",
  "data": null
}
```

### 3.5 查詢單筆資料

```http
GET /api/v1/std3000/data/{tKey}
```

**回應格式**:
```json
{
  "success": true,
  "code": 200,
  "message": "查詢成功",
  "data": {
    "tKey": 1,
    "dataId": "DATA001",
    "dataName": "資料名稱",
    "dataValue": "資料值",
    "dataType": "TYPE001",
    "status": "A",
    "sortOrder": 1,
    "memo": "備註",
    "createdBy": "USER001",
    "createdAt": "2024-01-01T00:00:00Z",
    "updatedBy": "USER001",
    "updatedAt": "2024-01-01T00:00:00Z"
  }
}
```

### 3.6 FR功能（特殊功能）

```http
POST /api/v1/std3000/data/{tKey}/fr
```

**請求體**:
```json
{
  "action": "SPECIAL_ACTION",
  "parameters": {
    "param1": "value1",
    "param2": "value2"
  }
}
```

**回應格式**:
```json
{
  "success": true,
  "code": 200,
  "message": "FR功能執行成功",
  "data": {
    "result": "執行結果"
  }
}
```

---

## 四、前端 UI 設計

### 4.1 資料列表頁面

#### 4.1.1 路由配置
- **路由**: `/std3000/data`
- **組件**: `Std3000DataList.vue`
- **權限**: `STD3000_DATA_VIEW`

#### 4.1.2 頁面結構
```
┌─────────────────────────────────────────┐
│  標準模組資料維護                        │
├─────────────────────────────────────────┤
│  [資料類型] [狀態] [關鍵字] [查詢]      │
├─────────────────────────────────────────┤
│  ┌───────────────────────────────────┐  │
│  │ 資料代碼 │ 資料名稱 │ 狀態 │ 操作 │  │
│  ├───────────────────────────────────┤  │
│  │ DATA001 │ 資料名稱1 │ 啟用 │ ... │  │
│  │ DATA002 │ 資料名稱2 │ 停用 │ ... │  │
│  └───────────────────────────────────┘  │
│  [新增]                    [1][2][3]    │
└─────────────────────────────────────────┘
```

#### 4.1.3 功能說明
- **篩選區**:
  - 資料類型下拉選單（選填）
  - 狀態下拉選單（全部/啟用/停用）
  - 關鍵字輸入框（搜尋資料代碼或名稱）
  - 查詢按鈕
- **資料表格**:
  - 顯示欄位：資料代碼、資料名稱、資料值、資料類型、狀態、排序順序、備註
  - 操作欄位：修改、刪除、FR功能按鈕
  - 支援排序（點擊欄位標題）
  - 支援分頁
- **操作按鈕**:
  - 新增按鈕：開啟新增對話框
  - 修改按鈕：開啟修改對話框
  - 刪除按鈕：確認後刪除
  - FR功能按鈕：執行特殊功能

### 4.2 資料維護對話框

#### 4.2.1 新增對話框
- **組件**: `Std3000DataDialog.vue`
- **模式**: `create`
- **表單欄位**:
  - 資料代碼（必填，文字輸入框）
  - 資料名稱（必填，文字輸入框）
  - 資料值（選填，文字輸入框）
  - 資料類型（選填，下拉選單）
  - 狀態（必填，下拉選單：啟用/停用，預設：啟用）
  - 排序順序（選填，數字輸入框，預設：0）
  - 備註（選填，文字區域）

#### 4.2.2 修改對話框
- **組件**: `Std3000DataDialog.vue`
- **模式**: `edit`
- **表單欄位**:
  - 資料代碼（唯讀，顯示）
  - 資料名稱（必填，文字輸入框）
  - 資料值（選填，文字輸入框）
  - 資料類型（選填，下拉選單）
  - 狀態（必填，下拉選單：啟用/停用）
  - 排序順序（選填，數字輸入框）
  - 備註（選填，文字區域）

### 4.3 FR功能對話框

#### 4.3.1 FR功能對話框
- **組件**: `Std3000FRDialog.vue`
- **功能**: 執行特殊功能
- **表單欄位**:
  - 功能選擇（下拉選單）
  - 參數設定（動態表單，根據功能選擇顯示不同參數）
  - 執行按鈕

---

## 五、開發時程

### 階段一：資料庫設計（0.5週）
- 資料表設計
- 索引設計
- 資料字典建立

### 階段二：後端API開發（1週）
- 查詢API開發
- 新增API開發
- 修改API開發
- 刪除API開發
- FR功能API開發

### 階段三：前端UI開發（1週）
- 資料列表頁面開發
- 資料維護對話框開發
- FR功能對話框開發
- 表單驗證實作

### 階段四：測試與優化（0.5週）
- 單元測試
- 整合測試
- 效能優化
- 文件整理

**總計**: 約 3 週

---

## 六、注意事項

### 6.1 資料驗證
- 資料代碼必須唯一
- 資料名稱不能為空
- 資料代碼格式驗證（根據業務需求）

### 6.2 權限控制
- 資料維護需特定權限
- FR功能需特定權限
- 刪除功能需確認對話框

### 6.3 效能考量
- 大量資料查詢需使用分頁
- 關鍵字搜尋需使用索引
- 資料表格需使用虛擬滾動（如資料量大）

### 6.4 資料備份
- 重要資料需定期備份
- 刪除操作需記錄日誌

---

## 七、測試案例

### 7.1 新增資料測試
- **測試案例1**: 正常新增
  - 輸入：完整的資料資訊
  - 預期：成功新增並顯示在列表中
- **測試案例2**: 資料代碼重複
  - 輸入：已存在的資料代碼
  - 預期：顯示錯誤訊息「資料代碼已存在」
- **測試案例3**: 必填欄位為空
  - 輸入：資料代碼或名稱為空
  - 預期：顯示驗證錯誤訊息

### 7.2 修改資料測試
- **測試案例1**: 正常修改
  - 輸入：修改資料名稱和狀態
  - 預期：成功修改並更新顯示
- **測試案例2**: 修改不存在的資料
  - 輸入：不存在的TKey
  - 預期：顯示錯誤訊息「資料不存在」

### 7.3 刪除資料測試
- **測試案例1**: 正常刪除
  - 輸入：選擇要刪除的資料
  - 預期：成功刪除並從列表中移除
- **測試案例2**: 刪除不存在的資料
  - 輸入：不存在的TKey
  - 預期：顯示錯誤訊息「資料不存在」

### 7.4 查詢資料測試
- **測試案例1**: 關鍵字搜尋
  - 輸入：關鍵字「DATA」
  - 預期：顯示所有包含「DATA」的資料
- **測試案例2**: 狀態篩選
  - 輸入：狀態「啟用」
  - 預期：只顯示狀態為「啟用」的資料
- **測試案例3**: 組合查詢
  - 輸入：資料類型「TYPE001」+ 狀態「啟用」
  - 預期：顯示符合兩個條件的資料

### 7.5 FR功能測試
- **測試案例1**: 正常執行FR功能
  - 輸入：選擇功能並設定參數
  - 預期：成功執行並顯示結果

---

## 八、參考資料

### 8.1 舊程式參考
- `WEB/IMS_CORE/ASP/STD3000/SYS3620_FB.ASP` - 瀏覽功能
- `WEB/IMS_CORE/ASP/STD3000/SYS3620_FI2.ASP` - 新增功能
- `WEB/IMS_CORE/ASP/STD3000/SYS3620_FQ.asp` - 查詢功能
- `WEB/IMS_CORE/ASP/STD3000/SYS3620_FQ2.ASP` - 查詢功能版本二
- `WEB/IMS_CORE/ASP/STD3000/SYS3620_FR.asp` - FR功能

### 8.2 相關文件
- 系統架構分析.md - STD3000 目錄分析
- 目錄掃描狀態統計.md - STD3000 模組狀態

### 8.3 技術文件
- .NET Core 8.0 API 開發指南
- Vue 3 開發指南
- Dapper 使用手冊
- SQL Server 資料庫設計指南

