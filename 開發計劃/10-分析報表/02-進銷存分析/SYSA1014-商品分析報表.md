# SYSA1014 - 商品分析報表 開發計劃

## 一、功能概述

### 1.1 功能說明
- **功能代碼**: SYSA1014
- **功能名稱**: 商品分析報表
- **功能描述**: 提供商品分析報表的查詢功能，支援依大分類、中分類、小分類、商品代碼、店別、日期範圍等條件查詢商品進銷存資訊，包含商品名稱、單位、數量、進貨數量、銷貨數量、庫存數量等資訊，支援報表列印與匯出
- **參考舊程式**: 
  - `WEB/IMS_CORE/SYSA000/backup/奇怪的程式碼/SYSA1014.ascx` (查詢頁面)
  - `WEB/IMS_CORE/SYSA000/backup/奇怪的程式碼/SYSA1014.ascx.cs` (後端邏輯)
  - `WEB/IMS_CORE/SYSA000/js/SYSA1014.js` (前端邏輯)
  - `WEB/IMS_CORE/SYSA000/SYSA1014.rdlc` (報表定義)
  - `WEB/IMS_CORE/SYSA000/backup/奇怪的程式碼/SYSA1000.aspx` (報表展示頁面)

### 1.2 業務需求
- 支援依大分類、中分類、小分類、商品代碼查詢
- 支援依店別查詢
- 支援依日期範圍查詢（日期起、日期訖）
- 支援依單位查詢
- 支援報表列印與匯出
- 顯示商品進銷存資訊（商品名稱、單位、數量、進貨數量、銷貨數量、庫存數量等）

---

## 二、資料庫設計 (Schema)

### 2.1 主要資料表

#### 2.1.1 `Goods` - 商品主檔 (對應舊系統 `IMS_AM.NAM_GOODS`)
- 參考: `開發計劃/10-分析報表/02-進銷存分析/SYSA1000-進銷存分析報表.md` 的 `Goods` 資料表結構

#### 2.1.2 `InventoryStocks` - 庫存資料表 (對應舊系統 `IMS_AM.NAM_AM_STOCKS`)
- 參考: `開發計劃/10-分析報表/02-進銷存分析/SYSA1000-進銷存分析報表.md` 的 `InventoryStocks` 資料表結構

#### 2.1.3 `PurchaseOrders` - 採購單主檔
- 參考: `開發計劃/04-採購管理/SYSW315-訂退貨申請作業.md` 的 `PurchaseOrders` 資料表結構

#### 2.1.4 `SalesOrders` - 銷貨單主檔
```sql
CREATE TABLE [dbo].[SalesOrders] (
    [OrderId] NVARCHAR(50) NOT NULL PRIMARY KEY,
    [OrderDate] DATETIME2 NOT NULL,
    [SiteId] NVARCHAR(50) NULL,
    [GoodsId] NVARCHAR(50) NOT NULL,
    [Qty] DECIMAL(18, 2) NOT NULL DEFAULT 0,
    [Unit] NVARCHAR(20) NULL,
    [Amount] DECIMAL(18, 2) NOT NULL DEFAULT 0,
    [Status] NVARCHAR(10) NOT NULL DEFAULT 'A',
    [CreatedBy] NVARCHAR(50) NULL,
    [CreatedAt] DATETIME2 NOT NULL DEFAULT GETDATE(),
    [UpdatedBy] NVARCHAR(50) NULL,
    [UpdatedAt] DATETIME2 NOT NULL DEFAULT GETDATE()
);

-- 索引
CREATE NONCLUSTERED INDEX [IX_SalesOrders_OrderDate] ON [dbo].[SalesOrders] ([OrderDate]);
CREATE NONCLUSTERED INDEX [IX_SalesOrders_SiteId] ON [dbo].[SalesOrders] ([SiteId]);
CREATE NONCLUSTERED INDEX [IX_SalesOrders_GoodsId] ON [dbo].[SalesOrders] ([GoodsId]);
```

### 2.2 報表資料結構

#### 2.2.1 報表資料集結構
```sql
-- 報表查詢結果結構
SELECT 
    SITE_ID,
    SITE_NAME,
    REPORT_NAME,
    SELECT_DATE,
    SELECT_TYPE,
    SEQ_NO,
    B_ID,
    M_ID,
    S_ID,
    GOODS_ID,
    GOODS_NAME,
    PACK_UNIT,
    UNIT,
    PURCHASE_QTY,
    SALES_QTY,
    STOCK_QTY,
    BEGIN_DATE,
    END_DATE
FROM 
    -- 查詢邏輯（需根據實際業務邏輯實作）
```

---

## 三、後端 API 設計

### 3.1 API 端點列表

#### 3.1.1 查詢商品分析報表
- **HTTP 方法**: `GET`
- **路徑**: `/api/v1/analysis-reports/sysa1014`
- **說明**: 查詢商品分析報表資料
- **請求參數**:
  ```json
  {
    "siteId": "",
    "bId": "",
    "mId": "",
    "sId": "",
    "orgId": "",
    "goodsId": "",
    "beginDate": "2024-01-01",
    "endDate": "2024-12-31",
    "pageIndex": 1,
    "pageSize": 20
  }
  ```
- **回應格式**:
  ```json
  {
    "success": true,
    "code": 200,
    "message": "查詢成功",
    "data": {
      "items": [
        {
          "siteId": "SITE001",
          "siteName": "店別名稱",
          "reportName": "商品分析報表",
          "selectDate": "2024-01-01 ~ 2024-12-31",
          "selectType": "全部",
          "seqNo": "1",
          "bId": "B001",
          "mId": "M001",
          "sId": "S001",
          "goodsId": "G001",
          "goodsName": "商品名稱",
          "packUnit": "箱",
          "unit": "個",
          "purchaseQty": 100,
          "salesQty": 80,
          "stockQty": 20,
          "beginDate": "2024-01-01",
          "endDate": "2024-12-31"
        }
      ],
      "totalCount": 100,
      "pageIndex": 1,
      "pageSize": 20,
      "totalPages": 5
    },
    "timestamp": "2024-01-01T00:00:00Z"
  }
  ```

#### 3.1.2 匯出商品分析報表
- **HTTP 方法**: `POST`
- **路徑**: `/api/v1/analysis-reports/sysa1014/export`
- **說明**: 匯出商品分析報表（Excel/PDF）
- **請求格式**: 同查詢參數
- **回應格式**: 檔案下載

#### 3.1.3 列印商品分析報表
- **HTTP 方法**: `POST`
- **路徑**: `/api/v1/analysis-reports/sysa1014/print`
- **說明**: 列印商品分析報表
- **請求格式**: 同查詢參數
- **回應格式**: PDF 檔案

### 3.2 後端實作類別

#### 3.2.1 Controller: `AnalysisReportsController.cs`
```csharp
namespace RSL.IMS3.Api.Controllers
{
    [ApiController]
    [Route("api/v1/analysis-reports")]
    [Authorize]
    public class AnalysisReportsController : ControllerBase
    {
        private readonly IAnalysisReportService _analysisReportService;
        
        public AnalysisReportsController(IAnalysisReportService analysisReportService)
        {
            _analysisReportService = analysisReportService;
        }
        
        [HttpGet("sysa1014")]
        public async Task<ActionResult<ApiResponse<PagedResult<SYSA1014ReportDto>>>> GetSYSA1014Report([FromQuery] SYSA1014QueryDto query)
        {
            var result = await _analysisReportService.GetSYSA1014ReportAsync(query);
            return Ok(ApiResponse.Success(result));
        }
        
        [HttpPost("sysa1014/export")]
        public async Task<IActionResult> ExportSYSA1014Report([FromBody] SYSA1014QueryDto query, [FromQuery] string format = "excel")
        {
            var fileBytes = await _analysisReportService.ExportSYSA1014ReportAsync(query, format);
            var fileName = $"SYSA1014_商品分析報表_{DateTime.Now:yyyyMMddHHmmss}.{(format == "excel" ? "xlsx" : "pdf")}";
            return File(fileBytes, format == "excel" ? "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" : "application/pdf", fileName);
        }
        
        [HttpPost("sysa1014/print")]
        public async Task<IActionResult> PrintSYSA1014Report([FromBody] SYSA1014QueryDto query)
        {
            var fileBytes = await _analysisReportService.PrintSYSA1014ReportAsync(query);
            var fileName = $"SYSA1014_商品分析報表_{DateTime.Now:yyyyMMddHHmmss}.pdf";
            return File(fileBytes, "application/pdf", fileName);
        }
    }
}
```

#### 3.2.2 Service: `AnalysisReportService.cs`
```csharp
namespace RSL.IMS3.Application.Services
{
    public interface IAnalysisReportService
    {
        Task<PagedResult<SYSA1014ReportDto>> GetSYSA1014ReportAsync(SYSA1014QueryDto query);
        Task<byte[]> ExportSYSA1014ReportAsync(SYSA1014QueryDto query, string format);
        Task<byte[]> PrintSYSA1014ReportAsync(SYSA1014QueryDto query);
    }
    
    public class AnalysisReportService : IAnalysisReportService
    {
        private readonly IDbConnection _db;
        private readonly IExcelService _excelService;
        private readonly IPdfService _pdfService;
        
        public AnalysisReportService(IDbConnection db, IExcelService excelService, IPdfService pdfService)
        {
            _db = db;
            _excelService = excelService;
            _pdfService = pdfService;
        }
        
        public async Task<PagedResult<SYSA1014ReportDto>> GetSYSA1014ReportAsync(SYSA1014QueryDto query)
        {
            // 實作查詢邏輯
            var sql = @"
                SELECT 
                    s.SiteId AS SiteId,
                    s.SiteName AS SiteName,
                    '商品分析報表' AS ReportName,
                    @BeginDate + ' ~ ' + @EndDate AS SelectDate,
                    '全部' AS SelectType,
                    ROW_NUMBER() OVER (ORDER BY g.GoodsId) AS SeqNo,
                    g.BId AS BId,
                    g.MId AS MId,
                    g.SId AS SId,
                    g.GoodsId AS GoodsId,
                    g.GoodsName AS GoodsName,
                    g.PackUnit AS PackUnit,
                    g.Unit AS Unit,
                    ISNULL(SUM(po.Qty), 0) AS PurchaseQty,
                    ISNULL(SUM(so.Qty), 0) AS SalesQty,
                    ISNULL(SUM(st.Qty), 0) AS StockQty,
                    @BeginDate AS BeginDate,
                    @EndDate AS EndDate
                FROM Goods g
                LEFT JOIN InventoryStocks st ON g.GoodsId = st.GoodsId
                LEFT JOIN PurchaseOrders po ON g.GoodsId = po.GoodsId AND po.OrderDate BETWEEN @BeginDate AND @EndDate
                LEFT JOIN SalesOrders so ON g.GoodsId = so.GoodsId AND so.OrderDate BETWEEN @BeginDate AND @EndDate
                LEFT JOIN Sites s ON st.SiteId = s.SiteId
                WHERE 1=1
                    AND (@SiteId IS NULL OR st.SiteId = @SiteId)
                    AND (@BId IS NULL OR g.BId = @BId)
                    AND (@MId IS NULL OR g.MId = @MId)
                    AND (@SId IS NULL OR g.SId = @SId)
                    AND (@OrgId IS NULL OR st.OrgId = @OrgId)
                    AND (@GoodsId IS NULL OR g.GoodsId = @GoodsId)
                GROUP BY s.SiteId, s.SiteName, g.BId, g.MId, g.SId, g.GoodsId, g.GoodsName, g.PackUnit, g.Unit
                ORDER BY g.GoodsId
                OFFSET @Offset ROWS FETCH NEXT @PageSize ROWS ONLY;
            ";
            
            var parameters = new
            {
                SiteId = query.SiteId,
                BId = query.BId,
                MId = query.MId,
                SId = query.SId,
                OrgId = query.OrgId,
                GoodsId = query.GoodsId,
                BeginDate = query.BeginDate,
                EndDate = query.EndDate,
                Offset = (query.PageIndex - 1) * query.PageSize,
                PageSize = query.PageSize
            };
            
            var items = await _db.QueryAsync<SYSA1014ReportDto>(sql, parameters);
            var totalCount = await _db.QuerySingleAsync<int>("SELECT COUNT(*) FROM ...", parameters);
            
            return new PagedResult<SYSA1014ReportDto>
            {
                Items = items.ToList(),
                TotalCount = totalCount,
                PageIndex = query.PageIndex,
                PageSize = query.PageSize,
                TotalPages = (int)Math.Ceiling(totalCount / (double)query.PageSize)
            };
        }
        
        public async Task<byte[]> ExportSYSA1014ReportAsync(SYSA1014QueryDto query, string format)
        {
            var data = await GetSYSA1014ReportAsync(query);
            
            if (format == "excel")
            {
                return await _excelService.ExportToExcelAsync(data.Items, "商品分析報表");
            }
            else
            {
                return await _pdfService.ExportToPdfAsync(data.Items, "商品分析報表");
            }
        }
        
        public async Task<byte[]> PrintSYSA1014ReportAsync(SYSA1014QueryDto query)
        {
            var data = await GetSYSA1014ReportAsync(query);
            return await _pdfService.PrintReportAsync(data.Items, "SYSA1014", query);
        }
    }
}
```

#### 3.2.3 DTO: `SYSA1014QueryDto.cs` 和 `SYSA1014ReportDto.cs`
```csharp
namespace RSL.IMS3.Application.DTOs
{
    public class SYSA1014QueryDto : PagedQueryDto
    {
        public string SiteId { get; set; }
        public string BId { get; set; }
        public string MId { get; set; }
        public string SId { get; set; }
        public string OrgId { get; set; }
        public string GoodsId { get; set; }
        public DateTime? BeginDate { get; set; }
        public DateTime? EndDate { get; set; }
    }
    
    public class SYSA1014ReportDto
    {
        public string SiteId { get; set; }
        public string SiteName { get; set; }
        public string ReportName { get; set; }
        public string SelectDate { get; set; }
        public string SelectType { get; set; }
        public string SeqNo { get; set; }
        public string BId { get; set; }
        public string MId { get; set; }
        public string SId { get; set; }
        public string GoodsId { get; set; }
        public string GoodsName { get; set; }
        public string PackUnit { get; set; }
        public string Unit { get; set; }
        public decimal PurchaseQty { get; set; }
        public decimal SalesQty { get; set; }
        public decimal StockQty { get; set; }
        public DateTime BeginDate { get; set; }
        public DateTime EndDate { get; set; }
    }
}
```

---

## 四、前端 UI 設計

### 4.1 頁面結構

#### 4.1.1 查詢頁面 (`/analysis-reports/sysa1014`)
- **路由**: `/analysis-reports/sysa1014`
- **組件**: `SYSA1014Query.vue`
- **功能**: 查詢條件設定、報表查詢、報表列印、報表匯出

#### 4.1.2 報表展示頁面 (`/analysis-reports/sysa1014/view`)
- **路由**: `/analysis-reports/sysa1014/view`
- **組件**: `SYSA1014ReportView.vue`
- **功能**: 報表資料展示、報表列印、報表匯出

### 4.2 查詢頁面設計

#### 4.2.1 查詢條件表單
```vue
<template>
  <div class="sysa1014-query">
    <el-form :model="queryForm" label-width="120px">
      <el-row :gutter="20">
        <el-col :span="12">
          <el-form-item label="店別" prop="siteId">
            <el-select v-model="queryForm.siteId" placeholder="請選擇店別" clearable>
              <el-option
                v-for="site in siteList"
                :key="site.siteId"
                :label="site.siteName"
                :value="site.siteId"
              />
            </el-select>
          </el-form-item>
        </el-col>
        <el-col :span="12">
          <el-form-item label="大分類" prop="bId">
            <el-select v-model="queryForm.bId" placeholder="請選擇大分類" clearable>
              <el-option
                v-for="category in bCategoryList"
                :key="category.categoryId"
                :label="category.categoryName"
                :value="category.categoryId"
              />
            </el-select>
          </el-form-item>
        </el-col>
      </el-row>
      <el-row :gutter="20">
        <el-col :span="12">
          <el-form-item label="中分類" prop="mId">
            <el-select v-model="queryForm.mId" placeholder="請選擇中分類" clearable>
              <el-option
                v-for="category in mCategoryList"
                :key="category.categoryId"
                :label="category.categoryName"
                :value="category.categoryId"
              />
            </el-select>
          </el-form-item>
        </el-col>
        <el-col :span="12">
          <el-form-item label="小分類" prop="sId">
            <el-select v-model="queryForm.sId" placeholder="請選擇小分類" clearable>
              <el-option
                v-for="category in sCategoryList"
                :key="category.categoryId"
                :label="category.categoryName"
                :value="category.categoryId"
              />
            </el-select>
          </el-form-item>
        </el-col>
      </el-row>
      <el-row :gutter="20">
        <el-col :span="12">
          <el-form-item label="單位" prop="orgId">
            <el-select v-model="queryForm.orgId" placeholder="請選擇單位" clearable>
              <el-option
                v-for="org in orgList"
                :key="org.orgId"
                :label="org.orgName"
                :value="org.orgId"
              />
            </el-select>
          </el-form-item>
        </el-col>
        <el-col :span="12">
          <el-form-item label="品項編號" prop="goodsId">
            <el-input v-model="queryForm.goodsId" placeholder="請輸入品項編號" clearable />
          </el-form-item>
        </el-col>
      </el-row>
      <el-row :gutter="20">
        <el-col :span="12">
          <el-form-item label="日期起" prop="beginDate">
            <el-date-picker
              v-model="queryForm.beginDate"
              type="date"
              placeholder="請選擇日期起"
              format="yyyy-MM-dd"
              value-format="yyyy-MM-dd"
            />
          </el-form-item>
        </el-col>
        <el-col :span="12">
          <el-form-item label="日期訖" prop="endDate">
            <el-date-picker
              v-model="queryForm.endDate"
              type="date"
              placeholder="請選擇日期訖"
              format="yyyy-MM-dd"
              value-format="yyyy-MM-dd"
            />
          </el-form-item>
        </el-col>
      </el-row>
      <el-form-item>
        <el-button type="primary" @click="handleQuery">查詢</el-button>
        <el-button @click="handleReset">重置</el-button>
        <el-button type="success" @click="handleExport">匯出</el-button>
        <el-button type="warning" @click="handlePrint">列印</el-button>
      </el-form-item>
    </el-form>
  </div>
</template>

<script setup lang="ts">
import { ref, reactive } from 'vue'
import { useRouter } from 'vue-router'
import { analysisReportApi } from '@/api/analysis-reports'
import type { SYSA1014QueryDto } from '@/types/analysis-reports'

const router = useRouter()
const queryForm = reactive<SYSA1014QueryDto>({
  siteId: '',
  bId: '',
  mId: '',
  sId: '',
  orgId: '',
  goodsId: '',
  beginDate: null,
  endDate: null,
  pageIndex: 1,
  pageSize: 20
})

const siteList = ref([])
const bCategoryList = ref([])
const mCategoryList = ref([])
const sCategoryList = ref([])
const orgList = ref([])

const handleQuery = async () => {
  // 驗證必填欄位
  if (!queryForm.beginDate || !queryForm.endDate) {
    ElMessage.warning('請選擇日期起和日期訖')
    return
  }
  
  // 導航到報表展示頁面
  router.push({
    path: '/analysis-reports/sysa1014/view',
    query: queryForm
  })
}

const handleReset = () => {
  Object.assign(queryForm, {
    siteId: '',
    bId: '',
    mId: '',
    sId: '',
    orgId: '',
    goodsId: '',
    beginDate: null,
    endDate: null,
    pageIndex: 1,
    pageSize: 20
  })
}

const handleExport = async () => {
  try {
    const response = await analysisReportApi.exportSYSA1014(queryForm, 'excel')
    const blob = new Blob([response.data], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' })
    const url = window.URL.createObjectURL(blob)
    const link = document.createElement('a')
    link.href = url
    link.download = `SYSA1014_商品分析報表_${new Date().toISOString().slice(0, 10)}.xlsx`
    link.click()
    window.URL.revokeObjectURL(url)
    ElMessage.success('匯出成功')
  } catch (error) {
    ElMessage.error('匯出失敗')
  }
}

const handlePrint = async () => {
  try {
    const response = await analysisReportApi.printSYSA1014(queryForm)
    const blob = new Blob([response.data], { type: 'application/pdf' })
    const url = window.URL.createObjectURL(blob)
    window.open(url, '_blank')
    ElMessage.success('列印成功')
  } catch (error) {
    ElMessage.error('列印失敗')
  }
}
</script>
```

### 4.3 報表展示頁面設計

#### 4.3.1 報表資料表格
```vue
<template>
  <div class="sysa1014-report-view">
    <el-table :data="reportData" border stripe style="width: 100%">
      <el-table-column prop="seqNo" label="序號" width="80" />
      <el-table-column prop="siteName" label="店別" width="120" />
      <el-table-column prop="goodsId" label="品項編號" width="120" />
      <el-table-column prop="goodsName" label="品項名稱" width="200" />
      <el-table-column prop="packUnit" label="包裝單位" width="100" />
      <el-table-column prop="unit" label="單位" width="80" />
      <el-table-column prop="purchaseQty" label="進貨數量" width="120" align="right" />
      <el-table-column prop="salesQty" label="銷貨數量" width="120" align="right" />
      <el-table-column prop="stockQty" label="庫存數量" width="120" align="right" />
    </el-table>
    <el-pagination
      v-model:current-page="pagination.pageIndex"
      v-model:page-size="pagination.pageSize"
      :total="pagination.totalCount"
      :page-sizes="[20, 50, 100, 200]"
      layout="total, sizes, prev, pager, next, jumper"
      @size-change="handleSizeChange"
      @current-change="handlePageChange"
    />
  </div>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue'
import { useRoute } from 'vue-router'
import { analysisReportApi } from '@/api/analysis-reports'
import type { SYSA1014ReportDto } from '@/types/analysis-reports'

const route = useRoute()
const reportData = ref<SYSA1014ReportDto[]>([])
const pagination = ref({
  pageIndex: 1,
  pageSize: 20,
  totalCount: 0
})

const loadReportData = async () => {
  try {
    const query = {
      ...route.query,
      pageIndex: pagination.value.pageIndex,
      pageSize: pagination.value.pageSize
    }
    const response = await analysisReportApi.getSYSA1014(query)
    reportData.value = response.data.items
    pagination.value.totalCount = response.data.totalCount
  } catch (error) {
    ElMessage.error('載入報表資料失敗')
  }
}

const handleSizeChange = (size: number) => {
  pagination.value.pageSize = size
  loadReportData()
}

const handlePageChange = (page: number) => {
  pagination.value.pageIndex = page
  loadReportData()
}

onMounted(() => {
  loadReportData()
})
</script>
```

---

## 五、開發任務清單

### 5.1 後端開發
- [ ] 建立 `SYSA1014QueryDto` 和 `SYSA1014ReportDto` DTO 類別
- [ ] 實作 `AnalysisReportService.GetSYSA1014ReportAsync` 方法
- [ ] 實作 `AnalysisReportService.ExportSYSA1014ReportAsync` 方法
- [ ] 實作 `AnalysisReportService.PrintSYSA1014ReportAsync` 方法
- [ ] 建立 `AnalysisReportsController.GetSYSA1014Report` API 端點
- [ ] 建立 `AnalysisReportsController.ExportSYSA1014Report` API 端點
- [ ] 建立 `AnalysisReportsController.PrintSYSA1014Report` API 端點
- [ ] 撰寫單元測試

### 5.2 前端開發
- [ ] 建立 `SYSA1014Query.vue` 查詢頁面組件
- [ ] 建立 `SYSA1014ReportView.vue` 報表展示頁面組件
- [ ] 建立 `analysisReportApi.getSYSA1014` API 方法
- [ ] 建立 `analysisReportApi.exportSYSA1014` API 方法
- [ ] 建立 `analysisReportApi.printSYSA1014` API 方法
- [ ] 建立路由設定
- [ ] 建立類型定義
- [ ] 撰寫單元測試

### 5.3 資料庫開發
- [ ] 確認 `Goods` 資料表結構
- [ ] 確認 `InventoryStocks` 資料表結構
- [ ] 確認 `PurchaseOrders` 資料表結構
- [ ] 確認 `SalesOrders` 資料表結構
- [ ] 建立必要的索引
- [ ] 撰寫查詢效能測試

### 5.4 測試
- [ ] 單元測試
- [ ] 整合測試
- [ ] 效能測試
- [ ] 使用者驗收測試

---

## 六、注意事項

1. **查詢效能**: 由於報表查詢可能涉及大量資料，需要優化查詢效能，建議使用適當的索引和分頁查詢
2. **日期範圍**: 日期起和日期訖為必填欄位，需要在前端和後端都進行驗證
3. **報表格式**: 支援 Excel 和 PDF 兩種格式的匯出，需要確保格式正確
4. **權限控制**: 需要根據使用者權限控制查詢、匯出、列印功能
5. **資料快取**: 對於大量資料的報表，可以考慮使用快取機制提升效能

