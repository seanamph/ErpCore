# SYSA1013 - 耗材出庫明細表 開發計劃

## 一、功能概述

### 1.1 功能說明
- **功能代碼**: SYSA1013
- **功能名稱**: 耗材出庫明細表
- **功能描述**: 提供耗材出庫明細表的查詢功能，包含出庫單號、出庫日期、單位、商品資訊、數量、金額、用途、廠商等資訊，支援多種查詢條件篩選
- **參考舊程式**: 
  - `WEB/IMS_CORE/SYSA000/backup/奇怪的程式碼/SYSA1000.aspx.cs` (報表邏輯)
  - `WEB/IMS_CORE/SYSA000/SYSA1013.rdlc` (報表定義)
  - `WEB/IMS_CORE/SYSA000/js/SYSA1013.js` (前端腳本)

### 1.2 業務需求
- 支援按日期範圍查詢耗材出庫明細
- 支援按店別、商品分類、商品代碼、單位、廠商、用途等條件篩選
- 支援報表列印與匯出 (Excel/PDF)
- 顯示出庫單號、出庫日期、單位、商品資訊、數量、金額、用途、廠商等資訊
- 支援多種篩選類型（全部、特定狀態等）

---

## 二、資料庫設計 (Schema)

### 2.1 主要資料表

#### 2.1.1 `InventoryStocks` - 庫存異動表 (對應舊系統 `IMS_AM.NAM_AM_STOCKS`)
- 參考: `開發計劃/10-分析報表/02-進銷存分析/SYSA1000-進銷存分析報表.md` 的 `InventoryStocks` 資料表結構

#### 2.1.2 `Goods` - 商品主檔 (對應舊系統 `IMS_AM.NAM_GOODS`)
- 參考: `開發計劃/10-分析報表/02-進銷存分析/SYSA1000-進銷存分析報表.md` 的 `Goods` 資料表結構

#### 2.1.3 `AcceptanceOrders` - 驗收單主檔 (對應舊系統 `IMS_AM.NAM_ACCEPTANCEM`)
```sql
CREATE TABLE [dbo].[AcceptanceOrders] (
    [TxnNo] NVARCHAR(50) NOT NULL PRIMARY KEY, -- 單號 (TXN_NO)
    [TxnDate] DATETIME2 NOT NULL, -- 單據日期 (TXN_DATE)
    [SupplierId] NVARCHAR(50) NULL, -- 廠商代碼 (SUPPLIER_ID)
    [SupplierName] NVARCHAR(200) NULL, -- 廠商名稱 (SUPPLIER_NAME)
    [OrgId] NVARCHAR(50) NULL, -- 單位代碼 (ORG_ID)
    [CreatedBy] NVARCHAR(50) NULL, -- 建立者
    [CreatedAt] DATETIME2 NOT NULL DEFAULT GETDATE(), -- 建立時間
    CONSTRAINT [PK_AcceptanceOrders] PRIMARY KEY CLUSTERED ([TxnNo] ASC)
);
```

#### 2.1.4 `AcceptanceOrderDetails` - 驗收單明細 (對應舊系統 `IMS_AM.NAM_ACCEPTANCED`)
```sql
CREATE TABLE [dbo].[AcceptanceOrderDetails] (
    [TxnNo] NVARCHAR(50) NOT NULL, -- 單號 (TXN_NO)
    [GoodsId] NVARCHAR(50) NOT NULL, -- 商品代碼 (GOODS_ID)
    [Qty] DECIMAL(18,2) NOT NULL DEFAULT 0, -- 數量 (QTY)
    [CreatedBy] NVARCHAR(50) NULL, -- 建立者
    [CreatedAt] DATETIME2 NOT NULL DEFAULT GETDATE(), -- 建立時間
    CONSTRAINT [PK_AcceptanceOrderDetails] PRIMARY KEY CLUSTERED ([TxnNo], [GoodsId]),
    CONSTRAINT [FK_AcceptanceOrderDetails_AcceptanceOrders] FOREIGN KEY ([TxnNo]) REFERENCES [dbo].[AcceptanceOrders] ([TxnNo])
);
```

#### 2.1.5 `RequisitionOrders` - 請購單主檔 (對應舊系統 `IMS_AM.NAM_REQUISITIONM`)
```sql
CREATE TABLE [dbo].[RequisitionOrders] (
    [TxnNo] NVARCHAR(50) NOT NULL PRIMARY KEY, -- 單號 (TXN_NO)
    [TxnDate] DATETIME2 NOT NULL, -- 單據日期 (TXN_DATE)
    [OrgId] NVARCHAR(50) NULL, -- 單位代碼 (ORG_ID)
    [OrgAllocation] NVARCHAR(200) NULL, -- 單位分攤 (ORG_ALLOCATION)
    [CreatedBy] NVARCHAR(50) NULL, -- 建立者
    [CreatedAt] DATETIME2 NOT NULL DEFAULT GETDATE(), -- 建立時間
    CONSTRAINT [PK_RequisitionOrders] PRIMARY KEY CLUSTERED ([TxnNo] ASC)
);
```

#### 2.1.6 `RequisitionOrderDetails` - 請購單明細 (對應舊系統 `IMS_AM.NAM_REQUISITIOND`)
```sql
CREATE TABLE [dbo].[RequisitionOrderDetails] (
    [TxnNo] NVARCHAR(50) NOT NULL, -- 單號 (TXN_NO)
    [GoodsId] NVARCHAR(50) NOT NULL, -- 商品代碼 (GOODS_ID)
    [Use] NVARCHAR(50) NULL, -- 用途 (USE)
    [CreatedBy] NVARCHAR(50) NULL, -- 建立者
    [CreatedAt] DATETIME2 NOT NULL DEFAULT GETDATE(), -- 建立時間
    CONSTRAINT [PK_RequisitionOrderDetails] PRIMARY KEY CLUSTERED ([TxnNo], [GoodsId]),
    CONSTRAINT [FK_RequisitionOrderDetails_RequisitionOrders] FOREIGN KEY ([TxnNo]) REFERENCES [dbo].[RequisitionOrders] ([TxnNo])
);
```

#### 2.1.7 `Organizations` - 單位主檔 (對應舊系統 `IMS3_BASE.ORG_GOUP`)
```sql
CREATE TABLE [dbo].[Organizations] (
    [OrgId] NVARCHAR(50) NOT NULL PRIMARY KEY, -- 單位代碼 (ORG_ID)
    [OrgName] NVARCHAR(200) NOT NULL, -- 單位名稱 (ORG_NAME)
    [Status] NVARCHAR(10) NOT NULL DEFAULT '1', -- 狀態
    [CreatedBy] NVARCHAR(50) NULL, -- 建立者
    [CreatedAt] DATETIME2 NOT NULL DEFAULT GETDATE(), -- 建立時間
    CONSTRAINT [PK_Organizations] PRIMARY KEY CLUSTERED ([OrgId] ASC)
);
```

### 2.2 報表查詢視圖

#### 2.2.1 `MaterialOutboundDetailView` - 耗材出庫明細視圖
```sql
CREATE VIEW [dbo].[MaterialOutboundDetailView] AS
SELECT 
    A.SourceId AS TxnNo,
    A.StocksDate AS TxnDate,
    C.BName AS BId,
    C.MName AS MId,
    C.SName AS SId,
    Goods.GoodsId,
    Goods.GoodsName,
    Goods.Notes AS PackUnit,
    P1.Content AS Unit,
    A.McAmt AS Amt,
    (A.Qty * -1) AS ApplyQty,
    A.Qty * -1 AS Qty,
    (A.Qty * -1 * A.McAmt) AS NAmt,
    P3.Content AS Use,
    E.SupplierId + '/' + E.SupplierName AS Vendor,
    P2.Content AS StocksType,
    ISNULL(G.OrgName, '找不到該單位') AS OrgId,
    M.OrgAllocation
FROM InventoryStocks A
LEFT JOIN Goods ON A.GoodsId = Goods.GoodsId
LEFT JOIN GoodsCategories C ON Goods.BId = C.BId 
    AND Goods.MId = C.MId 
    AND Goods.SId = C.SId
LEFT JOIN (
    SELECT T1.TxnNo, T1.SupplierId, T1.SupplierName, T1.OrgId, T2.Qty, T2.GoodsId
    FROM AcceptanceOrders T1
    INNER JOIN AcceptanceOrderDetails T2 ON T1.TxnNo = T2.TxnNo
) E ON A.SourceId = E.TxnNo AND A.GoodsId = E.GoodsId
LEFT JOIN (
    SELECT T1.TxnNo, T1.OrgId, T1.OrgAllocation, T2.Use, T2.GoodsId
    FROM RequisitionOrders T1
    INNER JOIN RequisitionOrderDetails T2 ON T1.TxnNo = T2.TxnNo
) M ON A.SourceId = M.TxnNo AND A.GoodsId = M.GoodsId
LEFT JOIN Parameters P1 ON Goods.Unit = P1.Tag AND P1.Title = 'NAM_MATERIAL'
LEFT JOIN Parameters P2 ON P2.Tag = A.StocksStatus AND P2.Title = 'STOCKS_TYPE'
LEFT JOIN Parameters P3 ON P3.Tag = M.Use AND P3.Title = 'GOODS_USE'
LEFT JOIN Organizations G ON ISNULL(E.OrgId, M.OrgId) = G.OrgId
WHERE C.ClassType = '1' 
    AND P2.Notes LIKE '%-%'
    AND A.StocksStatus IN ('1', '2', '3', '4', '5', '6', '8');
```

### 2.3 資料字典

| 欄位名稱 | 資料類型 | 說明 | 備註 |
|---------|---------|------|------|
| TxnNo | NVARCHAR(50) | 出庫單號 | 來源於庫存異動表的SourceId |
| TxnDate | DATETIME2 | 出庫日期 | 來源於庫存異動表的StocksDate |
| BId | NVARCHAR(50) | 大分類 | 商品分類 |
| MId | NVARCHAR(50) | 中分類 | 商品分類 |
| SId | NVARCHAR(50) | 小分類 | 商品分類 |
| GoodsId | NVARCHAR(50) | 商品代碼 | - |
| GoodsName | NVARCHAR(200) | 商品名稱 | - |
| PackUnit | NVARCHAR(50) | 包裝單位 | 商品備註欄位 |
| Unit | NVARCHAR(50) | 單位 | 參數表查詢 |
| Amt | DECIMAL(18,2) | 單價 | 庫存異動表的McAmt |
| ApplyQty | DECIMAL(18,2) | 申請數量 | 數量 * -1 |
| Qty | DECIMAL(18,2) | 數量 | 數量 * -1 |
| NAmt | DECIMAL(18,2) | 未稅金額 | 數量 * 單價 |
| Use | NVARCHAR(50) | 用途 | 參數表查詢 |
| Vendor | NVARCHAR(250) | 廠商 | 廠商代碼/廠商名稱 |
| StocksType | NVARCHAR(50) | 庫存類型 | 參數表查詢 |
| OrgId | NVARCHAR(200) | 單位 | 單位名稱 |
| OrgAllocation | NVARCHAR(200) | 單位分攤 | - |

---

## 三、後端 API 設計

### 3.1 API 端點列表

#### 3.1.1 查詢耗材出庫明細表
- **HTTP 方法**: `GET`
- **路徑**: `/api/v1/analysis/material-outbound-detail`
- **說明**: 查詢耗材出庫明細表資料
- **請求參數**:
  ```json
  {
    "siteId": "1100",
    "bId": "",
    "mId": "",
    "sId": "",
    "orgId": "",
    "goodsId": "",
    "beginDate": "2024-01-01",
    "endDate": "2024-12-31",
    "supplierId": "",
    "use": "",
    "filterType": "all",
    "pageIndex": 1,
    "pageSize": 20
  }
  ```
- **回應格式**:
  ```json
  {
    "success": true,
    "code": 200,
    "message": "查詢成功",
    "data": {
      "items": [
        {
          "txnNo": "510001",
          "txnDate": "2024-01-15T00:00:00",
          "bId": "大分類A",
          "mId": "中分類A",
          "sId": "小分類A",
          "goodsId": "G001",
          "goodsName": "商品A",
          "packUnit": "箱",
          "unit": "箱",
          "amt": 100.00,
          "applyQty": -10.00,
          "qty": -10.00,
          "nAmt": -1000.00,
          "use": "一般用途",
          "vendor": "S001/廠商A",
          "stocksType": "出庫",
          "orgId": "行政課",
          "orgAllocation": "公司負擔"
        }
      ],
      "totalCount": 100,
      "pageIndex": 1,
      "pageSize": 20,
      "totalPages": 5
    },
    "timestamp": "2024-01-01T00:00:00Z"
  }
  ```

#### 3.1.2 匯出耗材出庫明細表 (Excel)
- **HTTP 方法**: `GET`
- **路徑**: `/api/v1/analysis/material-outbound-detail/export/excel`
- **說明**: 匯出耗材出庫明細表為 Excel 檔案
- **請求參數**: 同查詢參數
- **回應**: Excel 檔案下載

#### 3.1.3 匯出耗材出庫明細表 (PDF)
- **HTTP 方法**: `GET`
- **路徑**: `/api/v1/analysis/material-outbound-detail/export/pdf`
- **說明**: 匯出耗材出庫明細表為 PDF 檔案
- **請求參數**: 同查詢參數
- **回應**: PDF 檔案下載

### 3.2 後端實作類別

#### 3.2.1 Controller: `MaterialOutboundDetailController.cs`
```csharp
namespace RSL.IMS3.Api.Controllers
{
    [ApiController]
    [Route("api/v1/analysis/material-outbound-detail")]
    [Authorize]
    public class MaterialOutboundDetailController : ControllerBase
    {
        private readonly IMaterialOutboundDetailService _service;
        
        public MaterialOutboundDetailController(IMaterialOutboundDetailService service)
        {
            _service = service;
        }
        
        [HttpGet]
        public async Task<ActionResult<ApiResponse<PagedResult<MaterialOutboundDetailDto>>>> GetMaterialOutboundDetail([FromQuery] MaterialOutboundDetailQueryDto query)
        {
            // 實作查詢邏輯
        }
        
        [HttpGet("export/excel")]
        public async Task<IActionResult> ExportToExcel([FromQuery] MaterialOutboundDetailQueryDto query)
        {
            // 實作Excel匯出邏輯
        }
        
        [HttpGet("export/pdf")]
        public async Task<IActionResult> ExportToPdf([FromQuery] MaterialOutboundDetailQueryDto query)
        {
            // 實作PDF匯出邏輯
        }
    }
}
```

#### 3.2.2 Service: `MaterialOutboundDetailService.cs`
```csharp
namespace RSL.IMS3.Application.Services
{
    public interface IMaterialOutboundDetailService
    {
        Task<PagedResult<MaterialOutboundDetailDto>> GetMaterialOutboundDetailAsync(MaterialOutboundDetailQueryDto query);
        Task<byte[]> ExportToExcelAsync(MaterialOutboundDetailQueryDto query);
        Task<byte[]> ExportToPdfAsync(MaterialOutboundDetailQueryDto query);
    }
}
```

#### 3.2.3 Repository: `MaterialOutboundDetailRepository.cs`
```csharp
namespace RSL.IMS3.Infrastructure.Data.Repositories
{
    public interface IMaterialOutboundDetailRepository
    {
        Task<PagedResult<MaterialOutboundDetail>> GetPagedAsync(MaterialOutboundDetailQuery query);
        Task<List<MaterialOutboundDetail>> GetAllAsync(MaterialOutboundDetailQuery query);
    }
}
```

---

## 四、前端 UI 設計

### 4.1 頁面結構

#### 4.1.1 耗材出庫明細表查詢頁面 (`MaterialOutboundDetailQuery.vue`)
- **路徑**: `/analysis/material-outbound-detail`
- **功能**: 顯示耗材出庫明細表查詢條件與結果
- **主要元件**:
  - 查詢表單 (MaterialOutboundDetailSearchForm)
  - 資料表格 (MaterialOutboundDetailDataTable)
  - 報表列印按鈕
  - 匯出按鈕 (Excel/PDF)

### 4.2 UI 元件設計

#### 4.2.1 查詢表單元件 (`MaterialOutboundDetailSearchForm.vue`)
```vue
<template>
  <el-form :model="searchForm" inline>
    <el-form-item label="店別">
      <el-select v-model="searchForm.siteId" placeholder="請選擇店別">
        <el-option v-for="site in siteList" :key="site.siteId" :label="site.siteName" :value="site.siteId" />
      </el-select>
    </el-form-item>
    <el-form-item label="大分類">
      <el-select v-model="searchForm.bId" placeholder="請選擇大分類">
        <el-option v-for="category in bCategoryList" :key="category.id" :label="category.name" :value="category.id" />
      </el-select>
    </el-form-item>
    <el-form-item label="中分類">
      <el-select v-model="searchForm.mId" placeholder="請選擇中分類" :disabled="!searchForm.bId">
        <el-option v-for="category in mCategoryList" :key="category.id" :label="category.name" :value="category.id" />
      </el-select>
    </el-form-item>
    <el-form-item label="小分類">
      <el-select v-model="searchForm.sId" placeholder="請選擇小分類" :disabled="!searchForm.mId">
        <el-option v-for="category in sCategoryList" :key="category.id" :label="category.name" :value="category.id" />
      </el-select>
    </el-form-item>
    <el-form-item label="單位">
      <el-select v-model="searchForm.orgId" placeholder="請選擇單位">
        <el-option v-for="org in orgList" :key="org.orgId" :label="org.orgName" :value="org.orgId" />
      </el-select>
    </el-form-item>
    <el-form-item label="商品代碼">
      <el-input v-model="searchForm.goodsId" placeholder="請輸入商品代碼" />
    </el-form-item>
    <el-form-item label="日期起">
      <el-date-picker v-model="searchForm.beginDate" type="date" placeholder="請選擇日期起" />
    </el-form-item>
    <el-form-item label="日期訖">
      <el-date-picker v-model="searchForm.endDate" type="date" placeholder="請選擇日期訖" />
    </el-form-item>
    <el-form-item label="廠商">
      <el-select v-model="searchForm.supplierId" placeholder="請選擇廠商">
        <el-option v-for="supplier in supplierList" :key="supplier.supplierId" :label="supplier.supplierName" :value="supplier.supplierId" />
      </el-select>
    </el-form-item>
    <el-form-item label="用途">
      <el-select v-model="searchForm.use" placeholder="請選擇用途">
        <el-option v-for="use in useList" :key="use.value" :label="use.label" :value="use.value" />
      </el-select>
    </el-form-item>
    <el-form-item label="篩選類型">
      <el-radio-group v-model="searchForm.filterType">
        <el-radio label="all">全部</el-radio>
        <el-radio label="specific">特定狀態</el-radio>
      </el-radio-group>
    </el-form-item>
    <el-form-item>
      <el-button type="primary" @click="handleSearch">查詢</el-button>
      <el-button @click="handleReset">重置</el-button>
      <el-button type="success" @click="handlePrint">列印</el-button>
      <el-button type="warning" @click="handleExportExcel">匯出Excel</el-button>
      <el-button type="info" @click="handleExportPdf">匯出PDF</el-button>
    </el-form-item>
  </el-form>
</template>
```

#### 4.2.2 資料表格元件 (`MaterialOutboundDetailDataTable.vue`)
```vue
<template>
  <div>
    <el-table :data="detailList" v-loading="loading" border stripe>
      <el-table-column prop="txnNo" label="出庫單號" width="120" />
      <el-table-column prop="txnDate" label="出庫日期" width="120" />
      <el-table-column prop="bId" label="大分類" width="100" />
      <el-table-column prop="mId" label="中分類" width="100" />
      <el-table-column prop="sId" label="小分類" width="100" />
      <el-table-column prop="goodsId" label="商品代碼" width="120" />
      <el-table-column prop="goodsName" label="商品名稱" width="200" />
      <el-table-column prop="packUnit" label="包裝單位" width="100" />
      <el-table-column prop="unit" label="單位" width="80" />
      <el-table-column prop="amt" label="單價" width="100" align="right">
        <template #default="{ row }">
          {{ formatCurrency(row.amt) }}
        </template>
      </el-table-column>
      <el-table-column prop="applyQty" label="申請數量" width="100" align="right">
        <template #default="{ row }">
          {{ formatNumber(row.applyQty) }}
        </template>
      </el-table-column>
      <el-table-column prop="qty" label="數量" width="100" align="right">
        <template #default="{ row }">
          {{ formatNumber(row.qty) }}
        </template>
      </el-table-column>
      <el-table-column prop="nAmt" label="未稅金額" width="120" align="right">
        <template #default="{ row }">
          {{ formatCurrency(row.nAmt) }}
        </template>
      </el-table-column>
      <el-table-column prop="use" label="用途" width="120" />
      <el-table-column prop="vendor" label="廠商" width="200" />
      <el-table-column prop="stocksType" label="庫存類型" width="100" />
      <el-table-column prop="orgId" label="單位" width="150" />
      <el-table-column prop="orgAllocation" label="單位分攤" width="150" />
    </el-table>
    <el-pagination
      v-model:current-page="pagination.pageIndex"
      v-model:page-size="pagination.pageSize"
      :total="pagination.totalCount"
      :page-sizes="[10, 20, 50, 100]"
      layout="total, sizes, prev, pager, next, jumper"
      @size-change="handleSizeChange"
      @current-change="handlePageChange"
    />
  </div>
</template>
```

### 4.3 API 呼叫 (`materialOutboundDetail.api.ts`)
```typescript
import request from '@/utils/request';

export interface MaterialOutboundDetailDto {
  txnNo: string;
  txnDate: string;
  bId: string;
  mId: string;
  sId: string;
  goodsId: string;
  goodsName: string;
  packUnit: string;
  unit: string;
  amt: number;
  applyQty: number;
  qty: number;
  nAmt: number;
  use: string;
  vendor: string;
  stocksType: string;
  orgId: string;
  orgAllocation: string;
}

export interface MaterialOutboundDetailQueryDto {
  siteId: string;
  bId?: string;
  mId?: string;
  sId?: string;
  orgId?: string;
  goodsId?: string;
  beginDate: string;
  endDate: string;
  supplierId?: string;
  use?: string;
  filterType?: string;
  pageIndex: number;
  pageSize: number;
}

// API 函數
export const getMaterialOutboundDetail = (query: MaterialOutboundDetailQueryDto) => {
  return request.get<ApiResponse<PagedResult<MaterialOutboundDetailDto>>>('/api/v1/analysis/material-outbound-detail', { params: query });
};

export const exportMaterialOutboundDetailToExcel = (query: MaterialOutboundDetailQueryDto) => {
  return request.get('/api/v1/analysis/material-outbound-detail/export/excel', { 
    params: query,
    responseType: 'blob'
  });
};

export const exportMaterialOutboundDetailToPdf = (query: MaterialOutboundDetailQueryDto) => {
  return request.get('/api/v1/analysis/material-outbound-detail/export/pdf', { 
    params: query,
    responseType: 'blob'
  });
};
```

---

## 五、開發時程

### 5.1 階段一: 資料庫設計 (1天)
- [ ] 確認相關資料表結構
- [ ] 建立報表查詢視圖
- [ ] 建立索引
- [ ] 資料庫遷移腳本

### 5.2 階段二: 後端開發 (3天)
- [ ] Entity 類別建立
- [ ] Repository 實作
- [ ] Service 實作
- [ ] Controller 實作
- [ ] DTO 類別建立
- [ ] Excel/PDF 匯出功能
- [ ] 單元測試

### 5.3 階段三: 前端開發 (3天)
- [ ] API 呼叫函數
- [ ] 查詢頁面開發
- [ ] 查詢表單開發
- [ ] 資料表格開發
- [ ] 報表列印功能
- [ ] Excel/PDF 匯出功能
- [ ] 元件測試

### 5.4 階段四: 整合測試 (1天)
- [ ] API 整合測試
- [ ] 端對端測試
- [ ] 效能測試
- [ ] 報表列印測試
- [ ] 匯出功能測試

### 5.5 階段五: 文件與部署 (1天)
- [ ] API 文件更新
- [ ] 使用者手冊
- [ ] 部署文件

**總計**: 9天

---

## 六、注意事項

### 6.1 效能
- 大量資料查詢必須使用分頁
- 必須建立適當的索引
- 複雜查詢應使用視圖或預存程序
- 報表匯出應使用非同步處理

### 6.2 資料驗證
- 日期範圍必須驗證
- 店別必須必填
- 查詢條件必須至少有一個

### 6.3 業務邏輯
- 數量計算為負數（出庫）
- 金額計算為數量 * 單價
- 單位資訊從參數表查詢
- 用途資訊從參數表查詢
- 庫存類型資訊從參數表查詢

### 6.4 報表功能
- 支援報表列印（使用RDLC或自訂報表引擎）
- 支援Excel匯出
- 支援PDF匯出
- 報表應包含表頭資訊（店別、日期範圍等）

---

## 七、測試案例

### 7.1 單元測試
- [ ] 查詢耗材出庫明細表成功
- [ ] 查詢耗材出庫明細表失敗 (缺少必要條件)
- [ ] 匯出Excel成功
- [ ] 匯出PDF成功

### 7.2 整合測試
- [ ] 完整查詢流程測試
- [ ] 權限檢查測試
- [ ] 資料驗證測試
- [ ] 錯誤處理測試
- [ ] 報表列印測試
- [ ] 匯出功能測試

### 7.3 效能測試
- [ ] 大量資料查詢測試
- [ ] 並發查詢測試
- [ ] 報表匯出效能測試

---

## 八、參考資料

### 8.1 舊程式碼
- `WEB/IMS_CORE/SYSA000/backup/奇怪的程式碼/SYSA1000.aspx.cs` (報表邏輯)
- `WEB/IMS_CORE/SYSA000/SYSA1013.rdlc` (報表定義)
- `WEB/IMS_CORE/SYSA000/js/SYSA1013.js` (前端腳本)

### 8.2 資料庫 Schema
- 舊系統 `IMS_AM.NAM_AM_STOCKS` 資料表結構
- 舊系統 `IMS_AM.NAM_GOODS` 資料表結構
- 舊系統 `IMS_AM.NAM_ACCEPTANCEM` 資料表結構
- 舊系統 `IMS_AM.NAM_ACCEPTANCED` 資料表結構
- 舊系統 `IMS_AM.NAM_REQUISITIONM` 資料表結構
- 舊系統 `IMS_AM.NAM_REQUISITIOND` 資料表結構
- 舊系統 `IMS3_BASE.ORG_GOUP` 資料表結構

---

**文件版本**: v1.0  
**建立日期**: 2024-01-01  
**最後更新**: 2024-01-01

