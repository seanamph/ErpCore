# SYS0810 - 系統作業與功能列表查詢 開發計劃

## 一、功能概述

### 1.1 功能說明
- **功能代碼**: SYS0810
- **功能名稱**: 系統作業與功能列表查詢
- **功能描述**: 提供系統作業與功能列表的查詢功能，可選擇主系統項目，然後顯示該系統下的所有作業與功能列表
- **參考舊程式**: 
  - `WEB/IMS_CORE/ASP/SYS0000/SYS0810_FQ.asp` (查詢條件頁面)
  - `WEB/IMS_CORE/ASP/SYS0000/SYS0810_PR.asp` (報表顯示頁面)
  - `WEB/IMS_CORE/ASP/SYS0000/SYS0810_PR_S.ASP` (報表顯示頁面簡化版)

### 1.2 業務需求
- 選擇主系統項目
- 顯示該系統下的所有作業與功能列表
- 支援作業與功能的瀏覽
- 支援報表列印功能
- 僅供查詢，不支援新增、修改、刪除操作

---

## 二、資料庫設計 (Schema)

### 2.1 主要資料表

#### 2.1.1 `Systems` - 主系統項目表 (對應舊系統 `MNG_SYS`)
```sql
CREATE TABLE [dbo].[Systems] (
    [SysId] NVARCHAR(50) NOT NULL PRIMARY KEY, -- 系統代碼 (SYS_ID)
    [SysName] NVARCHAR(100) NOT NULL, -- 系統名稱 (SYS_NAME)
    [SeqNo] INT NULL DEFAULT 0, -- 排序序號 (SEQ_NO)
    [Status] NVARCHAR(10) NOT NULL DEFAULT 'A', -- 狀態 (STATUS) A:啟用, I:停用
    [Notes] NVARCHAR(500) NULL, -- 備註 (NOTES)
    [CreatedBy] NVARCHAR(50) NULL,
    [CreatedAt] DATETIME2 NOT NULL DEFAULT GETDATE(),
    [UpdatedBy] NVARCHAR(50) NULL,
    [UpdatedAt] DATETIME2 NOT NULL DEFAULT GETDATE()
);
```

#### 2.1.2 `Programs` - 系統作業表 (對應舊系統 `MNG_PROG`)
```sql
CREATE TABLE [dbo].[Programs] (
    [ProgId] NVARCHAR(50) NOT NULL PRIMARY KEY, -- 作業代碼 (PROG_ID)
    [SysId] NVARCHAR(50) NOT NULL, -- 系統代碼 (SYS_ID)
    [ProgName] NVARCHAR(100) NOT NULL, -- 作業名稱 (PROG_NAME)
    [ProgType] NVARCHAR(20) NULL, -- 作業類型 (PROG_TYPE)
    [SeqNo] INT NULL DEFAULT 0, -- 排序序號 (SEQ_NO)
    [Status] NVARCHAR(10) NOT NULL DEFAULT 'A', -- 狀態 (STATUS) A:啟用, I:停用
    [Notes] NVARCHAR(500) NULL, -- 備註 (NOTES)
    [CreatedBy] NVARCHAR(50) NULL,
    [CreatedAt] DATETIME2 NOT NULL DEFAULT GETDATE(),
    [UpdatedBy] NVARCHAR(50) NULL,
    [UpdatedAt] DATETIME2 NOT NULL DEFAULT GETDATE(),
    CONSTRAINT [FK_Programs_Systems] FOREIGN KEY ([SysId]) REFERENCES [dbo].[Systems] ([SysId])
);
```

#### 2.1.3 `Buttons` - 系統功能按鈕表 (對應舊系統 `MNG_BUTTON`)
```sql
CREATE TABLE [dbo].[Buttons] (
    [ButtonId] NVARCHAR(50) NOT NULL PRIMARY KEY, -- 按鈕代碼 (BUTTON_ID)
    [ProgId] NVARCHAR(50) NOT NULL, -- 作業代碼 (PROG_ID)
    [ButtonName] NVARCHAR(100) NOT NULL, -- 按鈕名稱 (BUTTON_NAME)
    [ButtonType] NVARCHAR(20) NULL, -- 按鈕類型 (BUTTON_TYPE)
    [SeqNo] INT NULL DEFAULT 0, -- 排序序號 (SEQ_NO)
    [Status] NVARCHAR(10) NOT NULL DEFAULT 'A', -- 狀態 (STATUS) A:啟用, I:停用
    [Notes] NVARCHAR(500) NULL, -- 備註 (NOTES)
    [CreatedBy] NVARCHAR(50) NULL,
    [CreatedAt] DATETIME2 NOT NULL DEFAULT GETDATE(),
    [UpdatedBy] NVARCHAR(50) NULL,
    [UpdatedAt] DATETIME2 NOT NULL DEFAULT GETDATE(),
    CONSTRAINT [FK_Buttons_Programs] FOREIGN KEY ([ProgId]) REFERENCES [dbo].[Programs] ([ProgId])
);
```

### 2.2 資料字典

| 欄位名稱 | 資料類型 | 長度 | 允許NULL | 預設值 | 說明 | 備註 |
|---------|---------|------|---------|--------|------|------|
| SysId | NVARCHAR | 50 | NO | - | 系統代碼 | 主鍵 |
| SysName | NVARCHAR | 100 | NO | - | 系統名稱 | - |
| ProgId | NVARCHAR | 50 | NO | - | 作業代碼 | 主鍵 |
| ProgName | NVARCHAR | 100 | NO | - | 作業名稱 | - |
| ButtonId | NVARCHAR | 50 | NO | - | 按鈕代碼 | 主鍵 |
| ButtonName | NVARCHAR | 100 | NO | - | 按鈕名稱 | - |

---

## 三、後端 API 設計

### 3.1 API 端點列表

#### 3.1.1 查詢主系統列表
- **HTTP 方法**: `GET`
- **路徑**: `/api/v1/systems`
- **說明**: 查詢所有主系統項目列表，用於下拉選單
- **回應格式**: 標準列表回應格式

#### 3.1.2 查詢系統作業與功能列表
- **HTTP 方法**: `GET`
- **路徑**: `/api/v1/systems/{sysId}/programs-and-buttons`
- **說明**: 根據系統代碼查詢該系統下的所有作業與功能列表
- **路徑參數**:
  - `sysId`: 系統代碼
- **回應格式**:
  ```json
  {
    "success": true,
    "code": 200,
    "message": "查詢成功",
    "data": {
      "sysId": "SYS0000",
      "sysName": "系統管理",
      "programs": [
        {
          "progId": "SYS0110",
          "progName": "使用者基本資料維護",
          "progType": "MAINTENANCE",
          "seqNo": 1,
          "buttons": [
            {
              "buttonId": "BTN001",
              "buttonName": "新增",
              "buttonType": "ADD",
              "seqNo": 1
            }
          ]
        }
      ]
    },
    "timestamp": "2024-01-01T00:00:00Z"
  }
  ```

#### 3.1.3 匯出系統作業與功能列表報表
- **HTTP 方法**: `POST`
- **路徑**: `/api/v1/systems/{sysId}/programs-and-buttons/export`
- **說明**: 匯出系統作業與功能列表報表 (Excel/PDF)
- **路徑參數**:
  - `sysId`: 系統代碼
- **回應格式**: 檔案下載

---

## 四、前端 UI 設計

### 4.1 頁面結構

#### 4.1.1 系統作業與功能列表查詢頁面 (`SystemProgramButtonQuery.vue`)
- **路徑**: `/system/programs-and-buttons`
- **功能**: 選擇主系統項目，顯示該系統下的所有作業與功能列表
- **主要元件**:
  - 系統選擇下拉選單 (SystemSelect)
  - 作業與功能列表顯示 (ProgramButtonList)
  - 報表列印按鈕

### 4.2 主要元件

#### 4.2.1 系統選擇下拉選單
- 顯示所有主系統項目
- 選擇後自動載入該系統的作業與功能列表

#### 4.2.2 作業與功能列表顯示
- 以樹狀結構顯示：系統 > 作業 > 功能按鈕
- 顯示作業代碼、作業名稱、功能按鈕代碼、功能按鈕名稱
- 支援展開/收合

---

## 五、開發時程

**總計**: 8天
- 資料庫設計: 1天
- 後端API開發: 2天
- 前端UI開發: 3天
- 測試與修正: 2天

---

## 六、注意事項

### 6.1 安全性
- 必須驗證使用者權限
- 僅供查詢，不支援新增、修改、刪除操作

### 6.2 效能
- 大量作業與功能時需考慮效能
- 可使用分頁或虛擬滾動優化

### 6.3 業務邏輯
- 僅顯示啟用的系統、作業、功能按鈕
- 按照排序序號排序顯示

---

## 七、測試案例

### 7.1 單元測試
- [ ] 查詢主系統列表成功
- [ ] 查詢系統作業與功能列表成功
- [ ] 匯出 Excel 報表成功
- [ ] 匯出 PDF 報表成功

---

## 八、參考資料

### 8.1 舊程式碼
- `WEB/IMS_CORE/ASP/SYS0000/SYS0810_FQ.asp`
- `WEB/IMS_CORE/ASP/SYS0000/SYS0810_PR.asp`
- `WEB/IMS_CORE/ASP/SYS0000/SYS0810_PR_S.ASP`

### 8.2 相關功能
- CFG0410 - 主系統項目資料維護
- CFG0430 - 系統作業資料維護
- CFG0440 - 系統功能按鈕資料維護
- SYS0780 - 系統作業與功能列表查詢
- SYS0999 - 系統作業與功能列表查詢

---

**文件版本**: v1.0  
**建立日期**: 2024-01-01  
**最後更新**: 2024-01-01

