# SYS0760 - 使用者異常登入報表 開發計劃

## 一、功能概述

### 1.1 功能說明
- **功能代碼**: SYS0760
- **功能名稱**: 使用者異常登入報表
- **功能描述**: 提供使用者異常登入記錄的查詢、瀏覽、刪除及報表列印功能，用於監控系統安全與異常登入行為
- **參考舊程式**: 
  - `WEB/IMS_CORE/ASP/SYS0000/SYS0760_FQ.ASP` (查詢畫面)
  - `WEB/IMS_CORE/ASP/SYS0000/SYS0760_FB.ASP` (瀏覽畫面)
  - `WEB/IMS_CORE/ASP/SYS0000/SYS0760_FS.ASP` (顯示刪除畫面)
  - `WEB/IMS_CORE/ASP/SYS0000/SYS0760_FD.ASP` (刪除動作)
  - `IMS3/HANSHIN/IMS3/SYS0000/SYS0760_PR.aspx` (報表列印)
  - `IMS3/HANSHIN/RSL_CLASS/IMS3_SYS/LOGIN_LOG.cs` (資料存取類)

### 1.2 業務需求
- 查詢使用者異常登入記錄
- 支援多條件組合查詢（異常事件代碼、使用者代碼、事件時間範圍）
- 顯示異常登入詳細資訊
- 支援刪除異常登入記錄
- 支援報表列印功能
- 支援分頁瀏覽
- 支援多欄位排序

---

## 二、資料庫設計 (Schema)

### 2.1 主要資料表: `LoginLog`

```sql
CREATE TABLE [dbo].[LoginLog] (
    [T_KEY] BIGINT IDENTITY(1,1) NOT NULL PRIMARY KEY,
    [EVENT_ID] NVARCHAR(10) NOT NULL, -- 異常事件代碼 (1:密碼錯誤等)
    [USER_ID] NVARCHAR(50) NULL, -- 使用者代碼
    [LOGIN_IP] NVARCHAR(50) NULL, -- 登入IP位址
    [EVENT_TIME] DATETIME2 NOT NULL, -- 事件發生時間
    [BUSER] NVARCHAR(50) NULL, -- 建立使用者
    [BTIME] DATETIME2 NULL, -- 建立時間
    [CUSER] NVARCHAR(50) NULL, -- 異動使用者
    [CTIME] DATETIME2 NULL, -- 異動時間
    [CPRIORITY] INT NULL, -- 建立優先權
    [CGROUP] NVARCHAR(50) NULL, -- 建立群組
    CONSTRAINT [PK_LoginLog] PRIMARY KEY CLUSTERED ([T_KEY] ASC)
);

-- 索引
CREATE NONCLUSTERED INDEX [IX_LoginLog_EVENT_ID] ON [dbo].[LoginLog] ([EVENT_ID]);
CREATE NONCLUSTERED INDEX [IX_LoginLog_USER_ID] ON [dbo].[LoginLog] ([USER_ID]);
CREATE NONCLUSTERED INDEX [IX_LoginLog_EVENT_TIME] ON [dbo].[LoginLog] ([EVENT_TIME] DESC);
CREATE NONCLUSTERED INDEX [IX_LoginLog_USER_EVENT_TIME] ON [dbo].[LoginLog] ([USER_ID], [EVENT_TIME] DESC);
```

### 2.2 相關資料表

#### 2.2.1 `Users` - 使用者主檔 (關聯查詢使用者名稱)
```sql
-- 參考 Users 表的 USER_ID 和 USER_NAME 欄位
-- 用於 JOIN 查詢顯示使用者名稱
```

#### 2.2.2 `Parameters` - 參數設定表 (查詢異常事件代碼說明)
```sql
-- 查詢 TITLE = 'MNG_ERR_TYPE' 的參數
-- TAG: 事件代碼
-- CONTENT: 事件說明
```

---

## 三、後端 API 設計

### 3.1 查詢 API

#### 3.1.1 查詢異常登入記錄列表
```http
GET /api/v1/system/login-log
```

**查詢參數:**
```json
{
  "eventIds": ["1", "2"], // 異常事件代碼陣列 (可選)
  "userId": "USER001", // 使用者代碼 (可選，支援模糊查詢)
  "eventTimeFrom": "2024-01-01", // 事件時間起 (可選)
  "eventTimeTo": "2024-12-31", // 事件時間迄 (可選)
  "pageIndex": 1, // 頁碼 (預設: 1)
  "pageSize": 20, // 每頁筆數 (預設: 20)
  "sortBy": "EVENT_TIME", // 排序欄位 (預設: EVENT_TIME)
  "sortOrder": "DESC" // 排序方向: ASC/DESC (預設: DESC)
}
```

**回應:**
```json
{
  "success": true,
  "code": 200,
  "message": "查詢成功",
  "data": {
    "items": [
      {
        "tKey": 1,
        "eventId": "1",
        "eventIdName": "密碼錯誤",
        "userId": "USER001",
        "userName": "張三",
        "loginIp": "192.168.1.100",
        "eventTime": "2024-01-15T10:30:00",
        "bUser": "SYSTEM",
        "bTime": "2024-01-15T10:30:00",
        "cUser": null,
        "cTime": null,
        "cPriority": 0,
        "cGroup": null
      }
    ],
    "totalCount": 100,
    "pageIndex": 1,
    "pageSize": 20,
    "totalPages": 5
  },
  "timestamp": "2024-01-15T10:30:00Z"
}
```

#### 3.1.2 取得異常事件代碼選項
```http
GET /api/v1/system/login-log/event-types
```

**回應:**
```json
{
  "success": true,
  "code": 200,
  "message": "查詢成功",
  "data": [
    {
      "tag": "1",
      "content": "密碼錯誤"
    },
    {
      "tag": "2",
      "content": "帳號鎖定"
    }
  ],
  "timestamp": "2024-01-15T10:30:00Z"
}
```

### 3.2 刪除 API

#### 3.2.1 刪除異常登入記錄
```http
DELETE /api/v1/system/login-log
```

**請求體:**
```json
{
  "tKeys": [1, 2, 3] // 要刪除的記錄主鍵陣列
}
```

**回應:**
```json
{
  "success": true,
  "code": 200,
  "message": "刪除成功",
  "data": {
    "deletedCount": 3
  },
  "timestamp": "2024-01-15T10:30:00Z"
}
```

### 3.3 報表 API

#### 3.3.1 產生異常登入報表
```http
POST /api/v1/system/login-log/report
```

**請求體:**
```json
{
  "eventIds": ["1", "2"],
  "userId": "USER001",
  "eventTimeFrom": "2024-01-01",
  "eventTimeTo": "2024-12-31",
  "format": "PDF" // PDF/EXCEL
}
```

**回應:**
```json
{
  "success": true,
  "code": 200,
  "message": "報表產生成功",
  "data": {
    "reportUrl": "/api/v1/system/login-log/report/download?fileId=xxx",
    "fileName": "使用者異常登入報表_20240115.pdf"
  },
  "timestamp": "2024-01-15T10:30:00Z"
}
```

---

## 四、前端 UI 設計

### 4.1 查詢頁面 (Query)

**路由:** `/system/login-log/query`

**功能:**
- 異常事件代碼多選下拉 (從 Parameters 表查詢 TITLE='MNG_ERR_TYPE')
- 使用者代碼文字輸入框
- 事件時間範圍選擇器 (起/迄)
- 顯示欄位選擇 (多選)
- 排序欄位設定 (3個排序欄位，每個可選遞增/遞減)

**UI 元件:**
```vue
<template>
  <div class="login-log-query">
    <el-form :model="queryForm" label-width="120px">
      <el-row :gutter="20">
        <el-col :span="12">
          <el-form-item label="異常事件代碼">
            <el-select v-model="queryForm.eventIds" multiple placeholder="請選擇">
              <el-option
                v-for="item in eventTypes"
                :key="item.tag"
                :label="item.content"
                :value="item.tag">
              </el-option>
            </el-select>
          </el-form-item>
        </el-col>
        <el-col :span="12">
          <el-form-item label="使用者代碼">
            <el-input v-model="queryForm.userId" placeholder="請輸入使用者代碼" />
          </el-form-item>
        </el-col>
      </el-row>
      <el-row :gutter="20">
        <el-col :span="12">
          <el-form-item label="事件時間起">
            <el-date-picker
              v-model="queryForm.eventTimeFrom"
              type="datetime"
              placeholder="選擇日期時間"
              format="YYYY/MM/DD HH:mm:ss"
              value-format="YYYY-MM-DD HH:mm:ss" />
          </el-form-item>
        </el-col>
        <el-col :span="12">
          <el-form-item label="事件時間迄">
            <el-date-picker
              v-model="queryForm.eventTimeTo"
              type="datetime"
              placeholder="選擇日期時間"
              format="YYYY/MM/DD HH:mm:ss"
              value-format="YYYY-MM-DD HH:mm:ss" />
          </el-form-item>
        </el-col>
      </el-row>
      <el-row :gutter="20">
        <el-col :span="12">
          <el-form-item label="顯示欄位">
            <el-select v-model="queryForm.displayFields" multiple placeholder="請選擇顯示欄位">
              <el-option label="異常事件代碼" value="EVENT_ID" />
              <el-option label="使用者代碼" value="USER_ID" />
              <el-option label="IP位址" value="LOGIN_IP" />
              <el-option label="事件發生時間" value="EVENT_TIME" />
            </el-select>
          </el-form-item>
        </el-col>
      </el-row>
      <el-row :gutter="20">
        <el-col :span="8">
          <el-form-item label="排序欄位1">
            <el-select v-model="queryForm.sortBy1">
              <el-option label="異常事件代碼" value="EVENT_ID" />
              <el-option label="使用者代碼" value="USER_ID" />
              <el-option label="IP位址" value="LOGIN_IP" />
              <el-option label="事件發生時間" value="EVENT_TIME" />
            </el-select>
            <el-radio-group v-model="queryForm.sortOrder1">
              <el-radio label="ASC">遞增</el-radio>
              <el-radio label="DESC">遞減</el-radio>
            </el-radio-group>
          </el-form-item>
        </el-col>
        <el-col :span="8">
          <el-form-item label="排序欄位2">
            <el-select v-model="queryForm.sortBy2">
              <el-option label="異常事件代碼" value="EVENT_ID" />
              <el-option label="使用者代碼" value="USER_ID" />
              <el-option label="IP位址" value="LOGIN_IP" />
              <el-option label="事件發生時間" value="EVENT_TIME" />
            </el-select>
            <el-radio-group v-model="queryForm.sortOrder2">
              <el-radio label="ASC">遞增</el-radio>
              <el-radio label="DESC">遞減</el-radio>
            </el-radio-group>
          </el-form-item>
        </el-col>
        <el-col :span="8">
          <el-form-item label="排序欄位3">
            <el-select v-model="queryForm.sortBy3">
              <el-option label="異常事件代碼" value="EVENT_ID" />
              <el-option label="使用者代碼" value="USER_ID" />
              <el-option label="IP位址" value="LOGIN_IP" />
              <el-option label="事件發生時間" value="EVENT_TIME" />
            </el-select>
            <el-radio-group v-model="queryForm.sortOrder3">
              <el-radio label="ASC">遞增</el-radio>
              <el-radio label="DESC">遞減</el-radio>
            </el-radio-group>
          </el-form-item>
        </el-col>
      </el-row>
      <el-form-item>
        <el-button type="primary" @click="handleQuery">查詢</el-button>
        <el-button @click="handleReset">重置</el-button>
      </el-form-item>
    </el-form>
  </div>
</template>
```

### 4.2 瀏覽頁面 (Browse)

**路由:** `/system/login-log/browse`

**功能:**
- 顯示查詢結果列表
- 支援分頁瀏覽
- 支援欄位排序 (點擊欄位標題)
- 支援多選刪除
- 支援報表列印按鈕

**UI 元件:**
```vue
<template>
  <div class="login-log-browse">
    <div class="toolbar">
      <el-button type="danger" :disabled="selectedRows.length === 0" @click="handleDelete">
        刪除選中
      </el-button>
      <el-button type="primary" @click="handlePrint">列印報表</el-button>
      <el-button @click="handleBack">回查詢</el-button>
    </div>
    <el-table
      :data="tableData"
      @selection-change="handleSelectionChange"
      border
      stripe>
      <el-table-column type="selection" width="55" />
      <el-table-column type="index" label="序號" width="60" />
      <el-table-column
        v-if="displayFields.includes('EVENT_ID')"
        prop="eventIdName"
        label="異常事件代碼"
        sortable="custom"
        :sort-orders="['ascending', 'descending']"
        @sort-change="handleSortChange('EVENT_ID', $event)" />
      <el-table-column
        v-if="displayFields.includes('USER_ID')"
        label="使用者"
        sortable="custom"
        :sort-orders="['ascending', 'descending']"
        @sort-change="handleSortChange('USER_ID', $event)">
        <template #default="scope">
          ({{ scope.row.userId }}) {{ scope.row.userName }}
        </template>
      </el-table-column>
      <el-table-column
        v-if="displayFields.includes('LOGIN_IP')"
        prop="loginIp"
        label="IP位址"
        sortable="custom"
        :sort-orders="['ascending', 'descending']"
        @sort-change="handleSortChange('LOGIN_IP', $event)" />
      <el-table-column
        v-if="displayFields.includes('EVENT_TIME')"
        prop="eventTime"
        label="事件發生時間"
        sortable="custom"
        :sort-orders="['ascending', 'descending']"
        @sort-change="handleSortChange('EVENT_TIME', $event)"
        :formatter="formatDateTime" />
    </el-table>
    <el-pagination
      v-model:current-page="pagination.pageIndex"
      v-model:page-size="pagination.pageSize"
      :total="pagination.totalCount"
      :page-sizes="[10, 20, 50, 100]"
      layout="total, sizes, prev, pager, next, jumper"
      @size-change="handleSizeChange"
      @current-change="handlePageChange" />
  </div>
</template>
```

### 4.3 刪除確認頁面 (Delete Confirm)

**路由:** `/system/login-log/delete`

**功能:**
- 顯示待刪除記錄明細
- 確認刪除操作

### 4.4 報表列印頁面 (Report)

**路由:** `/system/login-log/report`

**功能:**
- 顯示報表預覽
- 支援 PDF/Excel 匯出

---

## 五、後端實作細節

### 5.1 Repository 層

#### 5.1.1 `ILoginLogRepository.cs`
```csharp
public interface ILoginLogRepository
{
    Task<PagedResult<LoginLogDto>> GetLoginLogListAsync(
        LoginLogQueryDto query,
        CancellationToken cancellationToken = default);
    
    Task<List<EventTypeDto>> GetEventTypesAsync(
        CancellationToken cancellationToken = default);
    
    Task<int> DeleteLoginLogsAsync(
        List<long> tKeys,
        CancellationToken cancellationToken = default);
    
    Task<byte[]> GenerateReportAsync(
        LoginLogReportDto reportDto,
        CancellationToken cancellationToken = default);
}
```

#### 5.1.2 `LoginLogRepository.cs`
```csharp
public class LoginLogRepository : ILoginLogRepository
{
    private readonly IDbConnection _connection;
    
    public async Task<PagedResult<LoginLogDto>> GetLoginLogListAsync(
        LoginLogQueryDto query,
        CancellationToken cancellationToken = default)
    {
        var sql = @"
            SELECT 
                L.T_KEY,
                L.EVENT_ID,
                (SELECT CONTENT FROM Parameters 
                 WHERE TITLE = 'MNG_ERR_TYPE' 
                 AND TAG = L.EVENT_ID 
                 AND STATUS = '1') AS EVENT_ID_NAME,
                L.USER_ID,
                U.USER_NAME,
                L.LOGIN_IP,
                L.EVENT_TIME,
                L.BUSER,
                L.BTIME,
                L.CUSER,
                L.CTIME,
                L.CPRIORITY,
                L.CGROUP
            FROM LoginLog L
            LEFT JOIN Users U ON L.USER_ID = U.USER_ID
            WHERE 1 = 1";
        
        var parameters = new DynamicParameters();
        
        // 異常事件代碼條件
        if (query.EventIds != null && query.EventIds.Any())
        {
            sql += " AND L.EVENT_ID IN @EventIds";
            parameters.Add("EventIds", query.EventIds);
        }
        
        // 使用者代碼條件 (模糊查詢)
        if (!string.IsNullOrWhiteSpace(query.UserId))
        {
            sql += " AND L.USER_ID LIKE @UserId";
            parameters.Add("UserId", $"%{query.UserId}%");
        }
        
        // 事件時間範圍
        if (query.EventTimeFrom.HasValue)
        {
            sql += " AND L.EVENT_TIME >= @EventTimeFrom";
            parameters.Add("EventTimeFrom", query.EventTimeFrom.Value);
        }
        
        if (query.EventTimeTo.HasValue)
        {
            sql += " AND L.EVENT_TIME <= @EventTimeTo";
            parameters.Add("EventTimeTo", query.EventTimeTo.Value);
        }
        
        // 只查詢異常事件 (EVENT_ID='1')
        sql += " AND L.EVENT_ID = '1'";
        
        // 排序
        var orderBy = BuildOrderBy(query);
        sql += $" ORDER BY {orderBy}";
        
        // 分頁
        var countSql = $"SELECT COUNT(*) FROM ({sql}) AS CountQuery";
        var totalCount = await _connection.QuerySingleAsync<int>(countSql, parameters);
        
        sql += " OFFSET @Offset ROWS FETCH NEXT @PageSize ROWS ONLY";
        parameters.Add("Offset", (query.PageIndex - 1) * query.PageSize);
        parameters.Add("PageSize", query.PageSize);
        
        var items = await _connection.QueryAsync<LoginLogDto>(sql, parameters);
        
        return new PagedResult<LoginLogDto>
        {
            Items = items.ToList(),
            TotalCount = totalCount,
            PageIndex = query.PageIndex,
            PageSize = query.PageSize,
            TotalPages = (int)Math.Ceiling(totalCount / (double)query.PageSize)
        };
    }
    
    private string BuildOrderBy(LoginLogQueryDto query)
    {
        var orders = new List<string>();
        
        if (!string.IsNullOrWhiteSpace(query.SortBy1))
        {
            orders.Add($"L.{query.SortBy1} {query.SortOrder1 ?? "ASC"}");
        }
        
        if (!string.IsNullOrWhiteSpace(query.SortBy2))
        {
            orders.Add($"L.{query.SortBy2} {query.SortOrder2 ?? "ASC"}");
        }
        
        if (!string.IsNullOrWhiteSpace(query.SortBy3))
        {
            orders.Add($"L.{query.SortBy3} {query.SortOrder3 ?? "ASC"}");
        }
        
        // 預設排序
        if (!orders.Any())
        {
            orders.Add("L.EVENT_TIME DESC");
            orders.Add("L.USER_ID ASC");
        }
        
        return string.Join(", ", orders);
    }
    
    public async Task<List<EventTypeDto>> GetEventTypesAsync(
        CancellationToken cancellationToken = default)
    {
        var sql = @"
            SELECT TAG AS Tag, CONTENT AS Content
            FROM Parameters
            WHERE TITLE = 'MNG_ERR_TYPE'
            AND STATUS = '1'
            ORDER BY TAG";
        
        var result = await _connection.QueryAsync<EventTypeDto>(sql);
        return result.ToList();
    }
    
    public async Task<int> DeleteLoginLogsAsync(
        List<long> tKeys,
        CancellationToken cancellationToken = default)
    {
        if (tKeys == null || !tKeys.Any())
            return 0;
        
        var sql = "DELETE FROM LoginLog WHERE T_KEY IN @TKeys";
        var parameters = new { TKeys = tKeys };
        
        return await _connection.ExecuteAsync(sql, parameters);
    }
}
```

### 5.2 Service 層

#### 5.2.1 `ILoginLogService.cs`
```csharp
public interface ILoginLogService
{
    Task<PagedResult<LoginLogDto>> GetLoginLogListAsync(
        LoginLogQueryDto query,
        CancellationToken cancellationToken = default);
    
    Task<List<EventTypeDto>> GetEventTypesAsync(
        CancellationToken cancellationToken = default);
    
    Task<int> DeleteLoginLogsAsync(
        List<long> tKeys,
        string currentUserId,
        CancellationToken cancellationToken = default);
    
    Task<ReportResultDto> GenerateReportAsync(
        LoginLogReportDto reportDto,
        CancellationToken cancellationToken = default);
}
```

#### 5.2.2 `LoginLogService.cs`
```csharp
public class LoginLogService : ILoginLogService
{
    private readonly ILoginLogRepository _repository;
    private readonly ILogger<LoginLogService> _logger;
    
    public async Task<PagedResult<LoginLogDto>> GetLoginLogListAsync(
        LoginLogQueryDto query,
        CancellationToken cancellationToken = default)
    {
        // 驗證查詢條件
        ValidateQuery(query);
        
        return await _repository.GetLoginLogListAsync(query, cancellationToken);
    }
    
    public async Task<int> DeleteLoginLogsAsync(
        List<long> tKeys,
        string currentUserId,
        CancellationToken cancellationToken = default)
    {
        if (tKeys == null || !tKeys.Any())
            throw new ArgumentException("刪除的記錄主鍵不能為空");
        
        // 記錄操作日誌
        _logger.LogInformation(
            "使用者 {UserId} 刪除異常登入記錄: {TKeys}",
            currentUserId,
            string.Join(",", tKeys));
        
        return await _repository.DeleteLoginLogsAsync(tKeys, cancellationToken);
    }
    
    private void ValidateQuery(LoginLogQueryDto query)
    {
        if (query.EventTimeFrom.HasValue && query.EventTimeTo.HasValue)
        {
            if (query.EventTimeFrom.Value > query.EventTimeTo.Value)
            {
                throw new ArgumentException("事件時間起不能大於事件時間迄");
            }
        }
    }
}
```

### 5.3 Controller 層

#### 5.3.1 `LoginLogController.cs`
```csharp
[ApiController]
[Route("api/v1/system/login-log")]
[Authorize]
public class LoginLogController : ControllerBase
{
    private readonly ILoginLogService _service;
    
    [HttpGet]
    public async Task<ActionResult<ApiResponse<PagedResult<LoginLogDto>>>> GetLoginLogList(
        [FromQuery] LoginLogQueryDto query,
        CancellationToken cancellationToken)
    {
        var result = await _service.GetLoginLogListAsync(query, cancellationToken);
        return Ok(ApiResponse.Success(result));
    }
    
    [HttpGet("event-types")]
    public async Task<ActionResult<ApiResponse<List<EventTypeDto>>>> GetEventTypes(
        CancellationToken cancellationToken)
    {
        var result = await _service.GetEventTypesAsync(cancellationToken);
        return Ok(ApiResponse.Success(result));
    }
    
    [HttpDelete]
    public async Task<ActionResult<ApiResponse<DeleteResultDto>>> DeleteLoginLogs(
        [FromBody] DeleteLoginLogRequest request,
        CancellationToken cancellationToken)
    {
        var currentUserId = User.FindFirst(ClaimTypes.NameIdentifier)?.Value;
        var deletedCount = await _service.DeleteLoginLogsAsync(
            request.TKeys,
            currentUserId,
            cancellationToken);
        
        return Ok(ApiResponse.Success(new DeleteResultDto
        {
            DeletedCount = deletedCount
        }));
    }
    
    [HttpPost("report")]
    public async Task<ActionResult<ApiResponse<ReportResultDto>>> GenerateReport(
        [FromBody] LoginLogReportDto reportDto,
        CancellationToken cancellationToken)
    {
        var result = await _service.GenerateReportAsync(reportDto, cancellationToken);
        return Ok(ApiResponse.Success(result));
    }
}
```

---

## 六、DTO 定義

### 6.1 `LoginLogDto.cs`
```csharp
public class LoginLogDto
{
    public long TKey { get; set; }
    public string EventId { get; set; }
    public string EventIdName { get; set; }
    public string UserId { get; set; }
    public string UserName { get; set; }
    public string LoginIp { get; set; }
    public DateTime EventTime { get; set; }
    public string BUser { get; set; }
    public DateTime? BTime { get; set; }
    public string CUser { get; set; }
    public DateTime? CTime { get; set; }
    public int? CPriority { get; set; }
    public string CGroup { get; set; }
}
```

### 6.2 `LoginLogQueryDto.cs`
```csharp
public class LoginLogQueryDto
{
    public List<string> EventIds { get; set; }
    public string UserId { get; set; }
    public DateTime? EventTimeFrom { get; set; }
    public DateTime? EventTimeTo { get; set; }
    public int PageIndex { get; set; } = 1;
    public int PageSize { get; set; } = 20;
    public string SortBy1 { get; set; }
    public string SortOrder1 { get; set; } = "ASC";
    public string SortBy2 { get; set; }
    public string SortOrder2 { get; set; } = "ASC";
    public string SortBy3 { get; set; }
    public string SortOrder3 { get; set; } = "ASC";
}
```

### 6.3 `EventTypeDto.cs`
```csharp
public class EventTypeDto
{
    public string Tag { get; set; }
    public string Content { get; set; }
}
```

---

## 七、開發時程

### 階段一: 資料庫設計與 Repository 層 (2天)
- [x] 建立 LoginLog 資料表
- [x] 建立索引
- [x] 實作 ILoginLogRepository
- [x] 單元測試

### 階段二: Service 層與 API 層 (2天)
- [x] 實作 ILoginLogService
- [x] 實作 LoginLogController
- [x] API 測試

### 階段三: 前端 UI 開發 (3天)
- [x] 查詢頁面
- [x] 瀏覽頁面
- [x] 刪除功能
- [x] 報表列印功能

### 階段四: 整合測試與優化 (1天)
- [x] 端對端測試
- [x] 效能優化
- [x] 文件整理

**總計: 8天**

---

## 八、注意事項

1. **安全性**
   - 刪除操作需要記錄操作日誌
   - 只有具備權限的使用者才能刪除記錄
   - 查詢結果需要進行權限過濾

2. **效能**
   - 大量資料查詢時需要分頁
   - 建立適當的索引以提升查詢效能
   - 考慮資料歸檔策略 (定期清理舊資料)

3. **資料完整性**
   - 刪除前需要確認記錄存在
   - 刪除操作需要事務處理

4. **使用者體驗**
   - 查詢條件需要提供預設值
   - 分頁大小可調整
   - 提供匯出功能

---

**文件版本**: v1.0  
**建立日期**: 2024-01-15  
**最後更新**: 2024-01-15

