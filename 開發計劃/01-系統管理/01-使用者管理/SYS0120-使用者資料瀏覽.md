# SYS0120 - 使用者資料瀏覽 開發計劃

## 一、功能概述

### 1.1 功能說明
- **功能代碼**: SYS0120
- **功能名稱**: 使用者資料瀏覽
- **功能描述**: 提供使用者資料的瀏覽功能，以只讀方式顯示使用者基本資料，不支援新增、修改、刪除操作
- **參考舊程式**: 
  - `WEB/IMS_CORE/SYS0000/SYS0120_FB.aspx` (瀏覽)

### 1.2 業務需求
- 提供使用者資料的瀏覽功能
- 支援使用者資料的快速查詢
- 支援使用者資料的詳細顯示
- 不支援資料的新增、修改、刪除操作

---

## 二、資料庫設計 (Schema)

### 2.1 主要資料表: `Users`
與 SYS0110 共用相同的資料表結構，請參考 SYS0110 的資料庫設計。

### 2.2 查詢視圖
本功能主要使用查詢功能，不需要額外的資料表設計。

---

## 三、後端 API 設計

### 3.1 API 端點列表

#### 3.1.1 查詢使用者列表（瀏覽模式）
- **HTTP 方法**: `GET`
- **路徑**: `/api/v1/users/browse`
- **說明**: 查詢使用者列表，僅供瀏覽，不支援修改
- **請求參數**: 與 SYS0110 的查詢參數相同
- **回應格式**: 與 SYS0110 的查詢回應相同

#### 3.1.2 查詢單筆使用者（瀏覽模式）
- **HTTP 方法**: `GET`
- **路徑**: `/api/v1/users/{userId}/browse`
- **說明**: 根據使用者編號查詢單筆使用者資料，僅供瀏覽
- **路徑參數**:
  - `userId`: 使用者編號
- **回應格式**: 與 SYS0110 的查詢單筆回應相同

### 3.2 後端實作類別

#### 3.2.1 Controller: `UsersController.cs`
在現有的 `UsersController` 中新增瀏覽相關的端點：

```csharp
[HttpGet("browse")]
public async Task<ActionResult<ApiResponse<PagedResult<UserDto>>>> BrowseUsers([FromQuery] UserQueryDto query)
{
    // 實作瀏覽查詢邏輯（與查詢相同，但標記為瀏覽模式）
}

[HttpGet("{userId}/browse")]
public async Task<ActionResult<ApiResponse<UserDto>>> BrowseUser(string userId)
{
    // 實作瀏覽單筆邏輯（與查詢相同，但標記為瀏覽模式）
}
```

---

## 四、前端 UI 設計

### 4.1 頁面結構

#### 4.1.1 使用者瀏覽頁面 (`UserBrowse.vue`)
- **路徑**: `/system/users/browse`
- **功能**: 顯示使用者列表，僅供瀏覽，不提供新增、修改、刪除功能
- **主要元件**:
  - 查詢表單 (UserSearchForm)
  - 資料表格 (UserBrowseTable) - 只讀模式
  - 詳細資料對話框 (UserDetailDialog) - 只讀模式

### 4.2 UI 元件設計

#### 4.2.1 瀏覽表格元件 (`UserBrowseTable.vue`)
```vue
<template>
  <div>
    <el-table :data="userList" v-loading="loading">
      <el-table-column prop="userId" label="使用者編號" width="120" />
      <el-table-column prop="userName" label="使用者名稱" width="150" />
      <el-table-column prop="title" label="職稱" width="100" />
      <el-table-column prop="orgName" label="組織" width="150" />
      <el-table-column prop="status" label="狀態" width="80">
        <template #default="{ row }">
          <el-tag :type="getStatusType(row.status)">
            {{ getStatusText(row.status) }}
          </el-tag>
        </template>
      </el-table-column>
      <el-table-column prop="lastLoginDate" label="最後登入" width="160" />
      <el-table-column label="操作" width="100" fixed="right">
        <template #default="{ row }">
          <el-button type="primary" size="small" @click="handleView(row)">查看</el-button>
        </template>
      </el-table-column>
    </el-table>
    <el-pagination
      v-model:current-page="pagination.pageIndex"
      v-model:page-size="pagination.pageSize"
      :total="pagination.totalCount"
      :page-sizes="[10, 20, 50, 100]"
      layout="total, sizes, prev, pager, next, jumper"
      @size-change="handleSizeChange"
      @current-change="handlePageChange"
    />
  </div>
</template>
```

#### 4.2.2 詳細資料對話框（只讀模式）(`UserDetailDialog.vue`)
```vue
<template>
  <el-dialog
    title="使用者詳細資料"
    v-model="visible"
    width="800px"
    :close-on-click-modal="false"
  >
    <el-descriptions :column="2" border>
      <el-descriptions-item label="使用者編號">{{ form.userId }}</el-descriptions-item>
      <el-descriptions-item label="使用者名稱">{{ form.userName }}</el-descriptions-item>
      <el-descriptions-item label="職稱">{{ form.title }}</el-descriptions-item>
      <el-descriptions-item label="組織">{{ form.orgName }}</el-descriptions-item>
      <el-descriptions-item label="有效起始日">{{ form.startDate }}</el-descriptions-item>
      <el-descriptions-item label="有效終止日">{{ form.endDate }}</el-descriptions-item>
      <el-descriptions-item label="狀態">
        <el-tag :type="getStatusType(form.status)">{{ getStatusText(form.status) }}</el-tag>
      </el-descriptions-item>
      <el-descriptions-item label="使用者型態">{{ form.userType }}</el-descriptions-item>
      <el-descriptions-item label="登入次數">{{ form.loginCount }}</el-descriptions-item>
      <el-descriptions-item label="最後登入時間">{{ form.lastLoginDate }}</el-descriptions-item>
      <el-descriptions-item label="最後登入IP">{{ form.lastLoginIp }}</el-descriptions-item>
      <el-descriptions-item label="備註" :span="2">{{ form.notes }}</el-descriptions-item>
    </el-descriptions>
    <template #footer>
      <el-button @click="handleClose">關閉</el-button>
    </template>
  </el-dialog>
</template>
```

### 4.3 API 呼叫 (`user.api.ts`)
在現有的 `user.api.ts` 中新增瀏覽相關的 API 函數：

```typescript
// 瀏覽使用者列表
export const browseUserList = (query: UserQueryDto) => {
  return request.get<ApiResponse<PagedResult<UserDto>>>('/api/v1/users/browse', { params: query });
};

// 瀏覽單筆使用者
export const browseUserById = (userId: string) => {
  return request.get<ApiResponse<UserDto>>(`/api/v1/users/${userId}/browse`);
};
```

---

## 五、開發時程

### 5.1 階段一: 後端開發 (1天)
- [ ] 新增瀏覽相關的 API 端點
- [ ] 單元測試

### 5.2 階段二: 前端開發 (2天)
- [ ] 瀏覽頁面開發
- [ ] 瀏覽表格元件開發
- [ ] 詳細資料對話框開發（只讀模式）
- [ ] API 呼叫函數
- [ ] 元件測試

### 5.3 階段三: 整合測試 (0.5天)
- [ ] API 整合測試
- [ ] 端對端測試

**總計**: 3.5天

---

## 六、注意事項

### 6.1 功能限制
- 本功能僅提供瀏覽功能，不支援新增、修改、刪除操作
- 所有資料欄位均為只讀模式
- 不提供編輯相關的按鈕和功能

### 6.2 權限控制
- 瀏覽功能需要適當的權限控制
- 確保使用者只能瀏覽有權限查看的資料

### 6.3 效能
- 大量資料查詢必須使用分頁
- 必須建立適當的索引

---

## 七、測試案例

### 7.1 單元測試
- [ ] 查詢使用者列表成功（瀏覽模式）
- [ ] 查詢單筆使用者成功（瀏覽模式）
- [ ] 權限檢查測試

### 7.2 整合測試
- [ ] 完整瀏覽流程測試
- [ ] 權限檢查測試
- [ ] 錯誤處理測試

---

## 八、參考資料

### 8.1 舊程式碼
- `WEB/IMS_CORE/SYS0000/SYS0120_FB.aspx`

### 8.2 相關功能
- SYS0110 - 使用者基本資料維護（完整 CRUD 功能）
- SYS0140 - 使用者資料查詢（查詢功能）

---

**文件版本**: v1.0  
**建立日期**: 2024-01-01  
**最後更新**: 2024-01-01

