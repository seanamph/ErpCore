# ECA3040 - 電子發票報表查詢 開發計劃

## 一、功能概述

### 1.1 功能說明
- **功能代碼**: ECA3040
- **功能名稱**: 電子發票報表查詢
- **功能描述**: 提供電子發票報表查詢與列印功能，用於產生電子發票統計報表、明細報表等
- **參考舊程式**: 
  - `WEB/IMS_CORE/ECA0000/ECA3040_PR.aspx` (報表頁面)
  - `WEB/IMS_CORE/ECA0000/ECA3040_PR.rdlc` (報表定義)

### 1.2 業務需求
- 支援電子發票統計報表查詢
- 支援電子發票明細報表查詢
- 支援多條件篩選
- 支援報表列印功能
- 支援報表匯出功能（Excel、PDF）

---

## 二、資料庫設計 (Schema)

### 2.1 主要資料表: `EInvoices` (對應舊系統電子發票主檔)

**說明**: 與 ECA3010、ECA3020 共用同一資料表

---

## 三、後端 API 設計

### 3.1 API 端點列表

#### 3.1.1 查詢電子發票報表
- **HTTP 方法**: `POST`
- **路徑**: `/api/v1/einvoices/report`
- **說明**: 查詢電子發票報表資料
- **請求格式**: 同 ECA3020 的查詢請求
- **回應格式**: 報表資料

#### 3.1.2 列印電子發票報表
- **HTTP 方法**: `POST`
- **路徑**: `/api/v1/einvoices/report/print`
- **說明**: 產生電子發票報表（PDF格式）
- **請求格式**: 同查詢請求
- **回應格式**: PDF檔案（二進位資料流）

---

## 四、前端 UI 設計

### 4.1 頁面結構

#### 4.1.1 電子發票報表頁面 (`EInvoiceReport.vue`)
- **路徑**: `/einvoice/report`
- **功能**: 顯示電子發票報表，支援查詢、列印、匯出
- **主要元件**:
  - 查詢表單 (EInvoiceReportForm)
  - 報表顯示區域
  - 列印按鈕
  - 匯出按鈕

---

## 五、開發任務清單

### 5.1 階段一: 資料庫設計 (0.5天)
- [x] 確認資料表結構

### 5.2 階段二: 後端開發 (2天)
- [ ] Controller 實作
- [ ] 報表查詢邏輯
- [ ] 報表列印功能（PDF）
- [ ] 單元測試

### 5.3 階段三: 前端開發 (2天)
- [ ] API 呼叫函數
- [ ] 報表頁面開發
- [ ] 報表顯示元件
- [ ] 列印功能開發
- [ ] 匯出功能開發

### 5.4 階段四: 整合測試 (1天)
- [ ] API 整合測試
- [ ] 端對端測試

**總計**: 5.5天

---

## 六、參考資料

### 6.1 舊程式碼
- `WEB/IMS_CORE/ECA0000/ECA3040_PR.aspx`
- `WEB/IMS_CORE/ECA0000/ECA3040_PR.rdlc`

### 6.2 相關開發計劃
- `開發計劃/08-電子發票/ECA3010-電子發票處理作業.md`
- `開發計劃/08-電子發票/ECA3020-電子發票查詢作業.md`

---

**文件版本**: v1.0  
**建立日期**: 2024-01-01  
**最後更新**: 2024-01-01

