# ECA4050 - 電子發票報表查詢(出貨日期統計) 開發計劃

## 一、功能概述

### 1.1 功能說明
- **功能代碼**: ECA4050
- **功能名稱**: 電子發票報表查詢(出貨日期統計)
- **功能描述**: 提供電子發票出貨日期統計報表的查詢與列印功能，包含出貨日期、銷售數量、銷售金額、運費、銷售占比等統計資訊
- **參考舊程式**: 
  - `WEB/IMS_CORE/ECA4000/ECA4050_PR.aspx` (報表頁面)
  - `WEB/IMS_CORE/ECA4000/ECA4050_PR.rdlc` (報表定義)
  - `WEB/IMS_CORE/ECA4000/ECA4000.xsd` (資料結構定義)

### 1.2 業務需求
- 查詢電子發票出貨日期統計資料
- 支援多條件篩選（出貨日期範圍等）
- 支援銷售統計（數量、金額、運費、占比）
- 支援報表列印與匯出功能

---

## 二、資料庫設計 (Schema)

### 2.1 報表查詢視圖: `V_ECA4050_Report`

```sql
CREATE VIEW [dbo].[V_ECA4050_Report] AS
SELECT 
    ei.[OrderShipDate] AS ORDERM_SHIPDATE,
    SUM(ei.[OrderQty]) AS SUM_QTY,
    SUM(ei.[OrderSubtotal]) AS SUM_SUBTOTAL,
    SUM(ei.[OrderShippingFee]) AS SUM_FEE,
    CASE 
        WHEN (SELECT SUM([OrderSubtotal]) FROM [dbo].[EInvoices] WHERE [ProcessStatus] = 'COMPLETED') > 0
        THEN (SUM(ei.[OrderSubtotal]) * 100.0) / (SELECT SUM([OrderSubtotal]) FROM [dbo].[EInvoices] WHERE [ProcessStatus] = 'COMPLETED')
        ELSE 0
    END AS SALES_PERCENT
FROM [dbo].[EInvoices] ei
WHERE ei.[ProcessStatus] = 'COMPLETED'
GROUP BY ei.[OrderShipDate];
```

---

## 三、後端 API 設計

### 3.1 API 端點
- `GET /api/v1/einvoices/reports/eca4050` - 查詢報表資料
- `POST /api/v1/einvoices/reports/eca4050/export/excel` - 匯出Excel
- `POST /api/v1/einvoices/reports/eca4050/export/pdf` - 匯出PDF
- `POST /api/v1/einvoices/reports/eca4050/print` - 列印報表

---

## 四、前端 UI 設計

### 4.1 頁面結構
- 查詢條件區塊：出貨日期範圍
- 報表資料區塊：出貨日期統計表格
- 統計資訊區塊：總數量、總金額等

---

## 五、實作細節

### 5.1 後端實作
- Repository: `GetECA4050ReportAsync()`
- Service: `GetECA4050ReportAsync()`
- Controller: `GetECA4050Report()`

### 5.2 前端實作
- API 服務: `getECA4050Report()`
- 頁面元件: `ECA4050Report.vue`

---

## 六、相關文件
- [ECA4010-電子發票報表查詢(訂單明細)](../ECA4010-電子發票報表查詢(訂單明細).md)

